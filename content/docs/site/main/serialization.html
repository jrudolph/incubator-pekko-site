<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Serialization APIs built into Apache Pekko.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Serialization APIs built into Apache Pekko.">
<link rel="shortcut icon" href="assets/images/favicon.png">
<title>Serialization Â· Apache Pekko</title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Serialization
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="images/pekko_logo.png" width="24" height="24">
</a>
<a href="index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="downloads.html" class="page">Downloads</a></li>
  <li><a href="documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="general/index.html" class="page">General Concepts</a></li>
    <li><a href="typed/index.html" class="page">Actors</a></li>
    <li><a href="typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="stream/index.html" class="page">Streams</a></li>
    <li><a href="discovery/index.html" class="page">Discovery</a></li>
    <li><a href="index-utilities.html" class="page">Utilities</a></li>
    <li><a href="common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="project/index.html" class="page">Project Information</a></li>
    <li><a href="index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="serialization.html#serialization" class="header">Serialization</a>
  <ul>
    <li><a href="serialization.html#dependency" class="header">Dependency</a></li>
    <li><a href="serialization.html#introduction" class="header">Introduction</a></li>
    <li><a href="serialization.html#usage" class="header">Usage</a></li>
    <li><a href="serialization.html#customization" class="header">Customization</a></li>
    <li><a href="serialization.html#serialization-of-pekkos-messages" class="header">Serialization of Pekko&rsquo;s messages</a></li>
    <li><a href="serialization.html#java-serialization" class="header">Java serialization</a></li>
    <li><a href="serialization.html#rolling-updates" class="header">Rolling updates</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="serialization.html#serialization" class="header">Serialization</a>
  <ul>
    <li><a href="serialization.html#dependency" class="header">Dependency</a></li>
    <li><a href="serialization.html#introduction" class="header">Introduction</a></li>
    <li><a href="serialization.html#usage" class="header">Usage</a></li>
    <li><a href="serialization.html#customization" class="header">Customization</a></li>
    <li><a href="serialization.html#serialization-of-pekkos-messages" class="header">Serialization of Pekko&rsquo;s messages</a></li>
    <li><a href="serialization.html#java-serialization" class="header">Java serialization</a></li>
    <li><a href="serialization.html#rolling-updates" class="header">Rolling updates</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#serialization" name="serialization" class="anchor"><span class="anchor-link"></span></a>Serialization</h1>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use Serialization, you must add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val PekkoVersion = "2.6.20+81-523134c3+20230202-1514-SNAPSHOT"
libraryDependencies += "org.apache.pekko" %% "pekko-actor" % PekkoVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
      &lt;artifactId&gt;pekko-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.6.20+81-523134c3+20230202-1514-SNAPSHOT&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
    &lt;artifactId&gt;pekko-actor_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("org.apache.pekko:pekko-bom_${versions.ScalaBinary}:2.6.20+81-523134c3+20230202-1514-SNAPSHOT")

  implementation "org.apache.pekko:pekko-actor_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>The messages that Pekko actors send to each other are JVM objects <span class="group-scala">(e.g. instances of Scala case classes)</span>. Message passing between actors that live on the same JVM is straightforward. It is done via reference passing. However, messages that have to escape the JVM to reach an actor running on a different host have to undergo some form of serialization (i.e. the objects have to be converted to and from byte arrays).</p>
<p>The serialization mechanism in Pekko allows you to write custom serializers and to define which serializer to use for what.</p>
<p><a href="serialization-jackson.html">Serialization with Jackson</a> is a good choice in many cases and our recommendation if you don&rsquo;t have other preference.</p>
<p><a href="https://developers.google.com/protocol-buffers/">Google Protocol Buffers</a> is good if you want more control over the schema evolution of your messages, but it requires more work to develop and maintain the mapping between serialized representation and domain representation.</p>
<p>Pekko itself uses Protocol Buffers to serialize internal messages (for example cluster gossip messages).</p>
<h2><a href="#usage" name="usage" class="anchor"><span class="anchor-link"></span></a>Usage</h2>
<h3><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h3>
<p>For Pekko to know which <code>Serializer</code> to use for what, you need to edit your configuration: in the <code>pekko.actor.serializers</code>-section, you bind names to implementations of the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/Serializer.html" title="org.apache.pekko.serialization.Serializer"><code>serialization.Serializer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/Serializer.html" title="org.apache.pekko.serialization.Serializer"><code>serialization.Serializer</code></a></span> you wish to use, like this:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L171-L180" target="_blank" title="Go to snippet source">source</a><code class="language-scala">pekko {
  actor {
    serializers {
      jackson-json = &quot;org.apache.pekko.serialization.jackson.JacksonJsonSerializer&quot;
      jackson-cbor = &quot;org.apache.pekko.serialization.jackson.JacksonCborSerializer&quot;
      proto = &quot;org.apache.pekko.remote.serialization.ProtobufSerializer&quot;
      myown = &quot;docs.serialization.MyOwnSerializer&quot;
    }
  }
}</code></pre>
<p>After you&rsquo;ve bound names to different implementations of <code>Serializer</code> you need to wire which classes should be serialized using which <code>Serializer</code>, this is done in the <code>pekko.actor.serialization-bindings</code>-section:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L190-L206" target="_blank" title="Go to snippet source">source</a><code class="language-scala">pekko {
  actor {
    serializers {
      jackson-json = &quot;org.apache.pekko.serialization.jackson.JacksonJsonSerializer&quot;
      jackson-cbor = &quot;org.apache.pekko.serialization.jackson.JacksonCborSerializer&quot;
      proto = &quot;org.apache.pekko.remote.serialization.ProtobufSerializer&quot;
      myown = &quot;docs.serialization.MyOwnSerializer&quot;
    }

    serialization-bindings {
      &quot;docs.serialization.JsonSerializable&quot; = jackson-json
      &quot;docs.serialization.CborSerializable&quot; = jackson-cbor
      &quot;com.google.protobuf.Message&quot; = proto
      &quot;docs.serialization.MyOwnSerializable&quot; = myown
    }
  }
}</code></pre>
<p>You only need to specify the name of <span class="group-scala">a trait</span><span class="group-java">an interface</span> or abstract base class of the messages. In case of ambiguity, i.e. the message implements several of the configured classes, the most specific configured class will be used, i.e. the one of which all other candidates are superclasses. If this condition cannot be met, because e.g. two marker <span class="group-scala">traits</span><span class="group-java">interfaces</span> that have been configured for serialization both apply and neither is a subtype of the other, a warning will be issued.</p><div class="callout note "><div class="callout-title">Note</div>
<p>If <span class="group-java">you are using Scala for your message protocol and</span> your messages are contained inside of a Scala object, then in order to reference those messages, you will need to use the fully qualified Java class name. For a message named <code>Message</code> contained inside the <span class="group-java">Scala</span> object named <code>Wrapper</code> you would need to reference it as <code>Wrapper$Message</code> instead of <code>Wrapper.Message</code>.</p></div>
<p>Pekko provides serializers for several primitive types and <a href="https://github.com/protocolbuffers/protobuf">protobuf</a> <a href="https://javadoc.io/doc/com.google.protobuf/protobuf-java/latest/com/google/protobuf/GeneratedMessage.html" title="com.google.protobuf.GeneratedMessage"><code>com.google.protobuf.GeneratedMessage</code></a> (protobuf2) and <a href="https://javadoc.io/doc/com.google.protobuf/protobuf-java/latest/com/google/protobuf/GeneratedMessageV3.html" title="com.google.protobuf.GeneratedMessageV3"><code>com.google.protobuf.GeneratedMessageV3</code></a> (protobuf3) by default (the latter only if depending on the pekko-remote module), so normally you don&rsquo;t need to add configuration for that if you send raw protobuf messages as actor messages.</p>
<h3><a href="#programmatic" name="programmatic" class="anchor"><span class="anchor-link"></span></a>Programmatic</h3>
<p>If you want to programmatically serialize/deserialize using Pekko Serialization, here are some examples:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L17-L22" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor._
import pekko.actor.typed.scaladsl.Behaviors
import pekko.cluster.Cluster
import pekko.serialization._
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/serialization/SerializationDocTest.java#L23-L28" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.*;
import org.apache.pekko.serialization.*;

import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
</code></pre></dd>
</dl>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L216-L230" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val system = ActorSystem(&quot;example&quot;)

// Get the Serialization Extension
val serialization = SerializationExtension(system)

// Have something to serialize
val original = &quot;woohoo&quot;

// Turn it into bytes, and retrieve the serializerId and manifest, which are needed for deserialization
val bytes = serialization.serialize(original).get
val serializerId = serialization.findSerializerFor(original).identifier
val manifest = Serializers.manifestFor(serialization.findSerializerFor(original), original)

// Turn it back into an object
val back = serialization.deserialize(bytes, serializerId, manifest).get</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/serialization/SerializationDocTest.java#L170-L185" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorSystem system = ActorSystem.create(&quot;example&quot;);

// Get the Serialization Extension
Serialization serialization = SerializationExtension.get(system);

// Have something to serialize
String original = &quot;woohoo&quot;;

// Turn it into bytes, and retrieve the serializerId and manifest, which are needed for
// deserialization
byte[] bytes = serialization.serialize(original).get();
int serializerId = serialization.findSerializerFor(original).identifier();
String manifest = Serializers.manifestFor(serialization.findSerializerFor(original), original);

// Turn it back into an object
String back = (String) serialization.deserialize(bytes, serializerId, manifest).get();</code></pre></dd>
</dl>
<p>The manifest is a type hint so that the same serializer can be used for different classes.</p>
<p>Note that when deserializing from bytes the manifest and the identifier of the serializer are needed. It is important to use the serializer identifier in this way to support rolling updates, where the <code>serialization-bindings</code> for a class may have changed from one serializer to another. Therefore the three parts consisting of the bytes, the serializer id, and the manifest should always be transferred or stored together so that they can be deserialized with different <code>serialization-bindings</code> configuration.</p>
<p>The <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/SerializationExtension$.html" title="org.apache.pekko.serialization.SerializationExtension"><code>SerializationExtension</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/SerializationExtension$.html" title="org.apache.pekko.serialization.SerializationExtension"><code>SerializationExtension</code></a></span> is a Classic <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/Extension.html" title="org.apache.pekko.actor.Extension"><code>Extension</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/Extension.html" title="org.apache.pekko.actor.Extension"><code>Extension</code></a></span>, but it can be used with an <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>actor.typed.ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>actor.typed.ActorSystem</code></a></span> like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L241-L246" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko.actor.typed.ActorSystem

val system = ActorSystem(Behaviors.empty, &quot;example&quot;)

// Get the Serialization Extension
val serialization = SerializationExtension(system)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/serialization/SerializationDocTest.java#L196-L200" target="_blank" title="Go to snippet source">source</a><code class="language-java">org.apache.pekko.actor.typed.ActorSystem&lt;Void&gt; system =
    org.apache.pekko.actor.typed.ActorSystem.create(Behaviors.empty(), &quot;example&quot;);

// Get the Serialization Extension
Serialization serialization = SerializationExtension.get(system);</code></pre></dd>
</dl>
<h2><a href="#customization" name="customization" class="anchor"><span class="anchor-link"></span></a>Customization</h2>
<p>The first code snippet on this page contains a configuration file that references a custom serializer <code>docs.serialization.MyOwnSerializer</code>. How would we go about creating such a custom serializer?</p>
<h3><a href="#creating-new-serializers" name="creating-new-serializers" class="anchor"><span class="anchor-link"></span></a>Creating new Serializers</h3>
<p>A custom <code>Serializer</code> has to inherit from <span class="group-scala"><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/Serializer.html" title="org.apache.pekko.serialization.Serializer"><code>serialization.Serializer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/Serializer.html" title="org.apache.pekko.serialization.Serializer"><code>serialization.Serializer</code></a></span></span><span class="group-java"><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/JSerializer.html" title="org.apache.pekko.serialization.JSerializer"><code>serialization.JSerializer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/JSerializer.html" title="org.apache.pekko.serialization.JSerializer"><code>serialization.JSerializer</code></a></span></span> and can be defined like the following:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L17-L22" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor._
import pekko.actor.typed.scaladsl.Behaviors
import pekko.cluster.Cluster
import pekko.serialization._
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/serialization/SerializationDocTest.java#L23-L28" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.*;
import org.apache.pekko.serialization.*;

import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
</code></pre></dd>
</dl>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L31-L62" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class MyOwnSerializer extends Serializer {

  // If you need logging here, introduce a constructor that takes an ExtendedActorSystem.
  // class MyOwnSerializer(actorSystem: ExtendedActorSystem) extends Serializer
  // Get a logger using:
  // private val logger = Logging(actorSystem, this)

  // This is whether &quot;fromBinary&quot; requires a &quot;clazz&quot; or not
  def includeManifest: Boolean = true

  // Pick a unique identifier for your Serializer,
  // you&#39;ve got a couple of billions to choose from,
  // 0 - 40 is reserved by Pekko itself
  def identifier = 1234567

  // &quot;toBinary&quot; serializes the given object to an Array of Bytes
  def toBinary(obj: AnyRef): Array[Byte] = {
    // Put the code that serializes the object here
    // #...
    Array[Byte]()
    // #...
  }

  // &quot;fromBinary&quot; deserializes the given array,
  // using the type hint (if any, see &quot;includeManifest&quot; above)
  def fromBinary(bytes: Array[Byte], clazz: Option[Class[_]]): AnyRef = {
    // Put your code that deserializes here
    // #...
    null
    // #...
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/serialization/SerializationDocTest.java#L34-L73" target="_blank" title="Go to snippet source">source</a><code class="language-java">static class MyOwnSerializer extends JSerializer {

  // If you need logging here, introduce a constructor that takes an ExtendedActorSystem.
  // public MyOwnSerializer(ExtendedActorSystem actorSystem)
  // Get a logger using:
  // private final LoggingAdapter logger = Logging.getLogger(actorSystem, this);

  // This is whether &quot;fromBinary&quot; requires a &quot;clazz&quot; or not
  @Override
  public boolean includeManifest() {
    return false;
  }

  // Pick a unique identifier for your Serializer,
  // you&#39;ve got a couple of billions to choose from,
  // 0 - 40 is reserved by Pekko itself
  @Override
  public int identifier() {
    return 1234567;
  }

  // &quot;toBinary&quot; serializes the given object to an Array of Bytes
  @Override
  public byte[] toBinary(Object obj) {
    // Put the code that serializes the object here
    // #...
    return new byte[0];
    // #...
  }

  // &quot;fromBinary&quot; deserializes the given array,
  // using the type hint (if any, see &quot;includeManifest&quot; above)
  @Override
  public Object fromBinaryJava(byte[] bytes, Class&lt;?&gt; clazz) {
    // Put your code that deserializes here
    // #...
    return null;
    // #...
  }
}</code></pre></dd>
</dl>
<p>The <code>identifier</code> must be unique. The identifier is used when selecting which serializer to use for deserialization. If you have accidentally configured several serializers with the same identifier that will be detected and prevent the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorSystem.html" title="org.apache.pekko.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorSystem.html" title="org.apache.pekko.actor.ActorSystem"><code>ActorSystem</code></a></span> from being started. It can be a hardcoded value because it must remain the same value to support rolling updates. </p><div class="group-scala">
<p>If you prefer to define the identifier in cofiguration that is supported by the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/BaseSerializer.html" title="org.apache.pekko.serialization.BaseSerializer"><code>BaseSerializer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/BaseSerializer.html" title="org.apache.pekko.serialization.BaseSerializer"><code>BaseSerializer</code></a></span> trait, which implements the <code>def identifier</code> by reading it from configuration based on the serializer&rsquo;s class name:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L126-L132" target="_blank" title="Go to snippet source">source</a><code class="language-scala">pekko {
  actor {
    serialization-identifiers {
      &quot;docs.serialization.MyOwnSerializer&quot; = 1234567
    }
  }
}</code></pre></dd>
</dl></div>
<p>The manifest is a type hint so that the same serializer can be used for different classes. The manifest parameter in <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/serialization/Serializer.html#fromBinary(bytes:Array[Byte],manifest:Option[Class[_]]):AnyRef" title="pekko.serialization.Serializer"><code>fromBinary</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/serialization/JSerializer.html#fromBinaryJava(byte[],java.lang.Class)" title="pekko.serialization.JSerializer"><code>fromBinaryJava</code></a></span> is the class of the object that was serialized. In <span class="group-scala"><code>fromBinary</code></span><span class="group-java"><code>fromBinaryJava</code></span> you can match on the class and deserialize the bytes to different objects.</p>
<p>Then you only need to fill in the blanks, bind it to a name in your configuration and list which classes should be deserialized with it.</p>
<p>The serializers are initialized eagerly by the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/SerializationExtension$.html" title="org.apache.pekko.serialization.SerializationExtension"><code>SerializationExtension</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/SerializationExtension$.html" title="org.apache.pekko.serialization.SerializationExtension"><code>SerializationExtension</code></a></span> when the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorSystem.html" title="org.apache.pekko.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorSystem.html" title="org.apache.pekko.actor.ActorSystem"><code>ActorSystem</code></a></span> is started and therefore a serializer itself must not access the <code>SerializationExtension</code> from its constructor. Instead, it should access the <code>SerializationExtension</code> lazily.</p>
<a id="string-manifest-serializer"></a>
<h3><a href="#serializer-with-string-manifest" name="serializer-with-string-manifest" class="anchor"><span class="anchor-link"></span></a>Serializer with String Manifest</h3>
<p>The <code>Serializer</code> illustrated above supports a class based manifest (type hint). For serialization of data that need to evolve over time the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/SerializerWithStringManifest.html" title="org.apache.pekko.serialization.SerializerWithStringManifest"><code>SerializerWithStringManifest</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/serialization/SerializerWithStringManifest.html" title="org.apache.pekko.serialization.SerializerWithStringManifest"><code>SerializerWithStringManifest</code></a></span> is recommended instead of <code>Serializer</code> because the manifest (type hint) is a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html" title="java.lang.String"><code>String</code></a> instead of a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Class.html" title="java.lang.Class"><code>Class</code></a>. That means that the class can be moved/removed and the serializer can still deserialize old data by matching on the <code>String</code>. This is especially useful for <a href="persistence.html">Persistence</a>.</p>
<p>The manifest string can also encode a version number that can be used in <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/serialization/Serializer.html#fromBinary(bytes:Array[Byte],manifest:Option[Class[_]]):AnyRef" title="pekko.serialization.Serializer"><code>fromBinary</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/serialization/JSerializer.html#fromBinaryJava(byte[],java.lang.Class)" title="pekko.serialization.JSerializer"><code>fromBinaryJava</code></a></span> to deserialize in different ways to migrate old data to new domain objects.</p>
<p>If the data was originally serialized with <code>Serializer</code> and in a later version of the system you change to <code>SerializerWithStringManifest</code> then the manifest string will be the full class name if you used <code>includeManifest=true</code>, otherwise it will be the empty string.</p>
<p>This is how a <code>SerializerWithStringManifest</code> looks like:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L66-L105" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class MyOwnSerializer2 extends SerializerWithStringManifest {

  val CustomerManifest = &quot;customer&quot;
  val UserManifest = &quot;user&quot;
  val UTF_8 = StandardCharsets.UTF_8.name()

  // Pick a unique identifier for your Serializer,
  // you&#39;ve got a couple of billions to choose from,
  // 0 - 40 is reserved by Pekko itself
  def identifier = 1234567

  // The manifest (type hint) that will be provided in the fromBinary method
  // Use `&quot;&quot;` if manifest is not needed.
  def manifest(obj: AnyRef): String =
    obj match {
      case _: Customer =&gt; CustomerManifest
      case _: User     =&gt; UserManifest
    }

  // &quot;toBinary&quot; serializes the given object to an Array of Bytes
  def toBinary(obj: AnyRef): Array[Byte] = {
    // Put the real code that serializes the object here
    obj match {
      case Customer(name) =&gt; name.getBytes(UTF_8)
      case User(name)     =&gt; name.getBytes(UTF_8)
    }
  }

  // &quot;fromBinary&quot; deserializes the given array,
  // using the type hint
  def fromBinary(bytes: Array[Byte], manifest: String): AnyRef = {
    // Put the real code that deserializes here
    manifest match {
      case CustomerManifest =&gt;
        Customer(new String(bytes, UTF_8))
      case UserManifest =&gt;
        User(new String(bytes, UTF_8))
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/serialization/SerializationDocTest.java#L94-L133" target="_blank" title="Go to snippet source">source</a><code class="language-java">static class MyOwnSerializer2 extends SerializerWithStringManifest {

  private static final String CUSTOMER_MANIFEST = &quot;customer&quot;;
  private static final String USER_MANIFEST = &quot;user&quot;;
  private static final Charset UTF_8 = StandardCharsets.UTF_8;

  // Pick a unique identifier for your Serializer,
  // you&#39;ve got a couple of billions to choose from,
  // 0 - 40 is reserved by Pekko itself
  @Override
  public int identifier() {
    return 1234567;
  }

  @Override
  public String manifest(Object obj) {
    if (obj instanceof Customer) return CUSTOMER_MANIFEST;
    else if (obj instanceof User) return USER_MANIFEST;
    else throw new IllegalArgumentException(&quot;Unknown type: &quot; + obj);
  }

  // &quot;toBinary&quot; serializes the given object to an Array of Bytes
  @Override
  public byte[] toBinary(Object obj) {
    // Put the real code that serializes the object here
    if (obj instanceof Customer) return ((Customer) obj).name.getBytes(UTF_8);
    else if (obj instanceof User) return ((User) obj).name.getBytes(UTF_8);
    else throw new IllegalArgumentException(&quot;Unknown type: &quot; + obj);
  }

  // &quot;fromBinary&quot; deserializes the given array,
  // using the type hint
  @Override
  public Object fromBinary(byte[] bytes, String manifest) {
    // Put the real code that deserializes here
    if (manifest.equals(CUSTOMER_MANIFEST)) return new Customer(new String(bytes, UTF_8));
    else if (manifest.equals(USER_MANIFEST)) return new User(new String(bytes, UTF_8));
    else throw new IllegalArgumentException(&quot;Unknown manifest: &quot; + manifest);
  }
}</code></pre></dd>
</dl>
<p>You must also bind it to a name in your configuration and then list which classes should be serialized by it.</p>
<p>It&rsquo;s recommended to throw <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/IllegalArgumentException.html" title="java.lang.IllegalArgumentException"><code>IllegalArgumentException</code></a> or <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/NotSerializableException.html" title="java.io.NotSerializableException"><code>NotSerializableException</code></a> in <code>fromBinary</code> if the manifest is unknown. This makes it possible to introduce new message types and send them to nodes that don&rsquo;t know about them. This is typically needed when performing rolling updates, i.e. running a cluster with mixed versions for a while. Those exceptions are treated as a transient problem in the classic remoting layer. The problem will be logged and the message dropped. Other exceptions will tear down the TCP connection because it can be an indication of corrupt bytes from the underlying transport. Artery TCP handles all deserialization exceptions as transient problems.</p>
<h3><a href="#serializing-actorrefs" name="serializing-actorrefs" class="anchor"><span class="anchor-link"></span></a>Serializing ActorRefs</h3>
<p>Actor references are typically included in the messages. All ActorRefs are serializable when using <a href="serialization-jackson.html">Serialization with Jackson</a>, but in case you are writing your own serializer, you might want to know how to serialize and deserialize them properly.</p>
<p>To serialize actor references to/from string representation you would use the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRefResolver.html" title="org.apache.pekko.actor.typed.ActorRefResolver"><code>ActorRefResolver</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRefResolver.html" title="org.apache.pekko.actor.typed.ActorRefResolver"><code>ActorRefResolver</code></a></span>.</p>
<p>For example here&rsquo;s how a serializer could look for <code>Ping</code> and <code>Pong</code> messages:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/PingSerializer.scala#L26-L62" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class PingSerializer(system: ExtendedActorSystem) extends SerializerWithStringManifest {
  private val actorRefResolver = ActorRefResolver(system.toTyped)

  private val PingManifest = &quot;a&quot;
  private val PongManifest = &quot;b&quot;

  override def identifier = 41

  override def manifest(msg: AnyRef) = msg match {
    case _: PingService.Ping =&gt; PingManifest
    case PingService.Pong    =&gt; PongManifest
    case _ =&gt;
      throw new IllegalArgumentException(s&quot;Can&#39;t serialize object of type ${msg.getClass} in [${getClass.getName}]&quot;)
  }

  override def toBinary(msg: AnyRef) = msg match {
    case PingService.Ping(who) =&gt;
      actorRefResolver.toSerializationFormat(who).getBytes(StandardCharsets.UTF_8)
    case PingService.Pong =&gt;
      Array.emptyByteArray
    case _ =&gt;
      throw new IllegalArgumentException(s&quot;Can&#39;t serialize object of type ${msg.getClass} in [${getClass.getName}]&quot;)
  }

  override def fromBinary(bytes: Array[Byte], manifest: String) = {
    manifest match {
      case PingManifest =&gt;
        val str = new String(bytes, StandardCharsets.UTF_8)
        val ref = actorRefResolver.resolveActorRef[PingService.Pong.type](str)
        PingService.Ping(ref)
      case PongManifest =&gt;
        PingService.Pong
      case _ =&gt;
        throw new IllegalArgumentException(s&quot;Unknown manifest [$manifest]&quot;)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/PingSerializerExampleTest.java#L37-L96" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class PingSerializer extends SerializerWithStringManifest {

  final ExtendedActorSystem system;
  final ActorRefResolver actorRefResolver;

  static final String PING_MANIFEST = &quot;a&quot;;
  static final String PONG_MANIFEST = &quot;b&quot;;

  PingSerializer(ExtendedActorSystem system) {
    this.system = system;
    actorRefResolver = ActorRefResolver.get(Adapter.toTyped(system));
  }

  @Override
  public int identifier() {
    return 97876;
  }

  @Override
  public String manifest(Object obj) {
    if (obj instanceof Ping) return PING_MANIFEST;
    else if (obj instanceof Pong) return PONG_MANIFEST;
    else
      throw new IllegalArgumentException(
          &quot;Can&#39;t serialize object of type &quot;
              + obj.getClass()
              + &quot; in [&quot;
              + getClass().getName()
              + &quot;]&quot;);
  }

  @Override
  public byte[] toBinary(Object obj) {
    if (obj instanceof Ping)
      return actorRefResolver
          .toSerializationFormat(((Ping) obj).replyTo)
          .getBytes(StandardCharsets.UTF_8);
    else if (obj instanceof Pong) return new byte[0];
    else
      throw new IllegalArgumentException(
          &quot;Can&#39;t serialize object of type &quot;
              + obj.getClass()
              + &quot; in [&quot;
              + getClass().getName()
              + &quot;]&quot;);
  }

  @Override
  public Object fromBinary(byte[] bytes, String manifest) {
    if (PING_MANIFEST.equals(manifest)) {
      String str = new String(bytes, StandardCharsets.UTF_8);
      ActorRef&lt;Pong&gt; ref = actorRefResolver.resolveActorRef(str);
      return new Ping(ref);
    } else if (PONG_MANIFEST.equals(manifest)) {
      return new Pong();
    } else {
      throw new IllegalArgumentException(&quot;Unable to handle manifest: &quot; + manifest);
    }
  }
}</code></pre></dd>
</dl>
<p>Serialization of Classic <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorRef.html" title="org.apache.pekko.actor.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorRef.html" title="org.apache.pekko.actor.ActorRef"><code>ActorRef</code></a></span> is described in <a href="serialization-classic.html#serializing-actorrefs">Classic Serialization</a>. Classic and Typed actor references have the same serialization format so they can be interchanged.</p>
<h3><a href="#deep-serialization-of-actors" name="deep-serialization-of-actors" class="anchor"><span class="anchor-link"></span></a>Deep serialization of Actors</h3>
<p>The recommended approach to do deep serialization of internal actor state is to use Pekko <a href="persistence.html">Persistence</a>.</p>
<h2><a href="#serialization-of-pekkos-messages" name="serialization-of-pekkos-messages" class="anchor"><span class="anchor-link"></span></a>Serialization of Pekko&rsquo;s messages</h2>
<p>Pekko is using a Protobuf 3 for serialization of messages defined by Pekko. This dependency is shaded in the <code>pekko-protobuf-v3</code> artifact so that applications can use another version of Protobuf.</p>
<p>Applications should use standard Protobuf dependency and not <code>pekko-protobuf-v3</code>.</p>
<h2><a href="#java-serialization" name="java-serialization" class="anchor"><span class="anchor-link"></span></a>Java serialization</h2>
<p>Java serialization is known to be slow and <a href="https://community.microfocus.com/cyberres/fortify/f/fortify-discussions/317555/the-perils-of-java-deserialization">prone to attacks</a> of various kinds - it never was designed for high throughput messaging after all. One may think that network bandwidth and latency limit the performance of remote messaging, but serialization is a more typical bottleneck.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Pekko serialization with Java serialization is disabled by default and Pekko itself doesn&rsquo;t use Java serialization for any of its internal messages. It is highly discouraged to enable Java serialization in production.</p>
<p>The log messages emitted by the disabled Java serializer in production SHOULD be treated as potential attacks which the serializer prevented, as they MAY indicate an external operator attempting to send malicious messages intending to use java serialization as attack vector. The attempts are logged with the SECURITY marker.</p></div>
<p>However, for early prototyping it is very convenient to use. For that reason and for compatibility with older systems that rely on Java serialization it can be enabled with the following configuration:</p>
<pre class="prettyprint"><code class="language-ruby">pekko.actor.allow-java-serialization = on
</code></pre>
<p>Pekko will still log warning when Java serialization is used and to silent that you may add:</p>
<pre class="prettyprint"><code class="language-ruby">pekko.actor.warn-about-java-serializer-usage = off
</code></pre>
<h3><a href="#java-serialization-compatibility" name="java-serialization-compatibility" class="anchor"><span class="anchor-link"></span></a>Java serialization compatibility</h3>
<p>It is not safe to mix major Scala versions when using the Java serialization as Scala does not guarantee compatibility and this could lead to very surprising errors.</p>
<h2><a href="#rolling-updates" name="rolling-updates" class="anchor"><span class="anchor-link"></span></a>Rolling updates</h2>
<p>A serialized remote message (or persistent event) consists of serializer-id, the manifest, and the binary payload. When deserializing it is only looking at the serializer-id to pick which <span class="group-scala"><code>Serializer</code></span><span class="group-java"><code>JSerializer</code></span> to use for <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/serialization/Serializer.html#fromBinary(bytes:Array[Byte],manifest:Option[Class[_]]):AnyRef" title="pekko.serialization.Serializer"><code>fromBinary</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/serialization/JSerializer.html#fromBinaryJava(byte[],java.lang.Class)" title="pekko.serialization.JSerializer"><code>fromBinaryJava</code></a></span>. The message class (the bindings) is not used for deserialization. The manifest is only used within the <span class="group-scala"><code>Serializer</code></span><span class="group-java"><code>JSerializer</code></span> to decide how to deserialize the payload, so one <span class="group-scala"><code>Serializer</code></span><span class="group-java"><code>JSerializer</code></span> can handle many classes.</p>
<p>That means that it is possible to change serialization for a message by performing two rolling update steps to switch to the new serializer.</p>
<ol>
  <li>
  <p>Add the <span class="group-scala"><code>Serializer</code></span><span class="group-java"><code>JSerializer</code></span> class and define it in <code>pekko.actor.serializers</code> config section, but not in  <code>pekko.actor.serialization-bindings</code>. Perform a rolling update for this change. This means that the  serializer class exists on all nodes and is registered, but it is still not used for serializing any  messages. That is important because during the rolling update the old nodes still don&rsquo;t know about  the new serializer and would not be able to deserialize messages with that format.</p></li>
  <li>
  <p>The second change is to register that the serializer is to be used for certain classes by defining  those in the <code>pekko.actor.serialization-bindings</code> config section. Perform a rolling update for this  change. This means that new nodes will use the new serializer when sending messages and old nodes will  be able to deserialize the new format. Old nodes will continue to use the old serializer when sending  messages and new nodes will be able to deserialize the old format.</p></li>
</ol>
<p>As an optional third step the old serializer can be completely removed if it was not used for persistent events. It must still be possible to deserialize the events that were stored with the old serializer.</p>
<h3><a href="#verification" name="verification" class="anchor"><span class="anchor-link"></span></a>Verification</h3>
<p>Normally, messages sent between local actors (i.e. same JVM) do not undergo serialization. For testing, sometimes, it may be desirable to force serialization on all messages (both remote and local). If you want to do this in order to verify that your messages are serializable you can enable the following config option:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L141-L145" target="_blank" title="Go to snippet source">source</a><code class="language-scala">pekko {
  actor {
    serialize-messages = on
  }
}</code></pre>
<p>Certain messages can be excluded from verification by extending the marker <span class="group-scala">trait</span><span class="group-java">interface</span> <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/NoSerializationVerificationNeeded.html" title="org.apache.pekko.actor.NoSerializationVerificationNeeded"><code>actor.NoSerializationVerificationNeeded</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/NoSerializationVerificationNeeded.html" title="org.apache.pekko.actor.NoSerializationVerificationNeeded"><code>actor.NoSerializationVerificationNeeded</code></a></span> or define a class name prefix in configuration <code>pekko.actor.no-serialization-verification-needed-class-prefix</code>.</p>
<p>If you want to verify that your <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/Props.html" title="org.apache.pekko.actor.Props"><code>Props</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/Props.html" title="org.apache.pekko.actor.Props"><code>Props</code></a></span> are serializable you can enable the following config option:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/serialization/SerializationDocSpec.scala#L156-L160" target="_blank" title="Go to snippet source">source</a><code class="language-scala">pekko {
  actor {
    serialize-creators = on
  }
}</code></pre><div class="callout warning "><div class="callout-title">Warning</div>
<p>We recommend having these config options turned on <strong>only</strong> when you&rsquo;re running tests. Turning these options on in production is pointless, as it would negatively impact the performance of local message passing without giving any gain.</p></div>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/serialization.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="typed/reliable-delivery.html" title="Reliable delivery" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Reliable delivery
</span>
</div>
</a>
<a href="serialization-jackson.html" title="Serialization with Jackson" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Serialization with Jackson
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright Â© 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="assets/js/groups.js"></script>
</body>
</html>
