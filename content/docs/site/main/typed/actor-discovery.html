<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Actor discovery · Apache Pekko</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Actor discovery
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../downloads.html" class="page">Downloads</a></li>
  <li><a href="../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../typed/index.html" class="page">Actors</a></li>
    <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../stream/index.html" class="page">Streams</a></li>
    <li><a href="../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../project/index.html" class="page">Project Information</a></li>
    <li><a href="../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/actor-discovery.html#actor-discovery" class="header">Actor discovery</a>
  <ul>
    <li><a href="../typed/actor-discovery.html#dependency" class="header">Dependency</a></li>
    <li><a href="../typed/actor-discovery.html#obtaining-actor-references" class="header">Obtaining Actor references</a></li>
    <li><a href="../typed/actor-discovery.html#receptionist" class="header">Receptionist</a></li>
    <li><a href="../typed/actor-discovery.html#cluster-receptionist" class="header">Cluster Receptionist</a></li>
    <li><a href="../typed/actor-discovery.html#receptionist-scalability" class="header">Receptionist Scalability</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/actor-discovery.html#actor-discovery" class="header">Actor discovery</a>
  <ul>
    <li><a href="../typed/actor-discovery.html#dependency" class="header">Dependency</a></li>
    <li><a href="../typed/actor-discovery.html#obtaining-actor-references" class="header">Obtaining Actor references</a></li>
    <li><a href="../typed/actor-discovery.html#receptionist" class="header">Receptionist</a></li>
    <li><a href="../typed/actor-discovery.html#cluster-receptionist" class="header">Cluster Receptionist</a></li>
    <li><a href="../typed/actor-discovery.html#receptionist-scalability" class="header">Receptionist Scalability</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#actor-discovery" name="actor-discovery" class="anchor"><span class="anchor-link"></span></a>Actor discovery</h1>
<p>You are viewing the documentation for the new actor APIs, to view the Pekko Classic documentation, see <a href="../actors.html#actorselection">Classic Actors</a>.</p>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use Pekko Actor Typed, you must add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val PekkoVersion = "2.6.20+81-523134c3+20230202-1514-SNAPSHOT"
libraryDependencies += "org.apache.pekko" %% "pekko-actor-typed" % PekkoVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
      &lt;artifactId&gt;pekko-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.6.20+81-523134c3+20230202-1514-SNAPSHOT&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
    &lt;artifactId&gt;pekko-actor-typed_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("org.apache.pekko:pekko-bom_${versions.ScalaBinary}:2.6.20+81-523134c3+20230202-1514-SNAPSHOT")

  implementation "org.apache.pekko:pekko-actor-typed_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<h2><a href="#obtaining-actor-references" name="obtaining-actor-references" class="anchor"><span class="anchor-link"></span></a>Obtaining Actor references</h2>
<p>There are two general ways to obtain <a href="../general/addressing.html#what-is-an-actor-reference">Actor references</a>: by <a href="actor-lifecycle.html#creating-actors">creating actors</a> and by discovery using the <a href="actor-discovery.html#receptionist">Receptionist</a>.</p>
<p>You can pass actor references between actors as constructor parameters or part of messages.</p>
<p>Sometimes, you need something to bootstrap the interaction, for example when actors are running on different nodes in the Cluster or when &ldquo;dependency injection&rdquo; with constructor parameters is not applicable.</p>
<h2><a href="#receptionist" name="receptionist" class="anchor"><span class="anchor-link"></span></a>Receptionist</h2>
<p>When an actor needs to be discovered by another actor but you are unable to put a reference to it in an incoming message, you can use the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/receptionist/Receptionist.html" title="org.apache.pekko.actor.typed.receptionist.Receptionist"><code>Receptionist</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/receptionist/Receptionist.html" title="org.apache.pekko.actor.typed.receptionist.Receptionist"><code>Receptionist</code></a></span>. It supports both local and cluster(see <a href="actor-discovery.html#cluster-receptionist">cluster</a>). You register the specific actors that should be discoverable from each node in the local <code>Receptionist</code> instance. The API of the receptionist is also based on actor messages. This registry of actor references is then automatically distributed to all other nodes in the case of a cluster. You can lookup such actors with the key that was used when they were registered. The reply to such a <code>Find</code> request is a <code>Listing</code>, which contains a <code>Set</code> of actor references that are registered for the key. Note that several actors can be registered to the same key.</p>
<p>The registry is dynamic. New actors can be registered during the lifecycle of the system. Entries are removed when registered actors are stopped, manually deregistered or the node they live on is removed from the <a href="cluster.html">Cluster</a>. To facilitate this dynamic aspect you can also subscribe to changes with the <code>Receptionist.Subscribe</code> message. It will send <code>Listing</code> messages to the subscriber, first with the set of entries upon subscription, then whenever the entries for a key are changed.</p>
<p>These imports are used in the following example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/ReceptionistExample.scala#L17-L22" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.typed.ActorRef
import pekko.actor.typed.Behavior
import pekko.actor.typed.receptionist.Receptionist
import pekko.actor.typed.receptionist.ServiceKey
import pekko.actor.typed.scaladsl.Behaviors</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/ReceptionistExample.java#L17-L22" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.typed.ActorRef;
import org.apache.pekko.actor.typed.Behavior;
import org.apache.pekko.actor.typed.javadsl.ActorContext;
import org.apache.pekko.actor.typed.javadsl.Behaviors;
import org.apache.pekko.actor.typed.receptionist.Receptionist;
import org.apache.pekko.actor.typed.receptionist.ServiceKey;</code></pre></dd>
</dl>
<p>First we create a <code>PingService</code> actor and register it with the <code>Receptionist</code> against a <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/receptionist/ServiceKey.html" title="org.apache.pekko.actor.typed.receptionist.ServiceKey"><code>ServiceKey</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/receptionist/ServiceKey.html" title="org.apache.pekko.actor.typed.receptionist.ServiceKey"><code>ServiceKey</code></a></span> that will later be used to lookup the reference:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/ReceptionistExample.scala#L27-L45" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object PingService {
  val PingServiceKey = ServiceKey[Ping](&quot;pingService&quot;)

  final case class Ping(replyTo: ActorRef[Pong.type])
  case object Pong

  def apply(): Behavior[Ping] = {
    Behaviors.setup { context =&gt;
      context.system.receptionist ! Receptionist.Register(PingServiceKey, context.self)

      Behaviors.receiveMessage {
        case Ping(replyTo) =&gt;
          context.log.info(&quot;Pinged by {}&quot;, replyTo)
          replyTo ! Pong
          Behaviors.same
      }
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/ReceptionistExample.java#L29-L71" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class PingService {

  public static final ServiceKey&lt;Ping&gt; pingServiceKey =
      ServiceKey.create(Ping.class, &quot;pingService&quot;);

  public static class Pong {}

  public static class Ping {
    private final ActorRef&lt;Pong&gt; replyTo;

    public Ping(ActorRef&lt;Pong&gt; replyTo) {
      this.replyTo = replyTo;
    }
  }

  public static Behavior&lt;Ping&gt; create() {
    return Behaviors.setup(
        context -&gt; {
          context
              .getSystem()
              .receptionist()
              .tell(Receptionist.register(pingServiceKey, context.getSelf()));

          return new PingService(context).behavior();
        });
  }

  private final ActorContext&lt;Ping&gt; context;

  private PingService(ActorContext&lt;Ping&gt; context) {
    this.context = context;
  }

  private Behavior&lt;Ping&gt; behavior() {
    return Behaviors.receive(Ping.class).onMessage(Ping.class, this::onPing).build();
  }

  private Behavior&lt;Ping&gt; onPing(Ping msg) {
    context.getLog().info(&quot;Pinged by {}&quot;, msg.replyTo);
    msg.replyTo.tell(new Pong());
    return Behaviors.same();
  }
}</code></pre></dd>
</dl>
<p>Then we have another actor that requires a <code>PingService</code> to be constructed:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/ReceptionistExample.scala#L49-L60" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object Pinger {
  def apply(pingService: ActorRef[PingService.Ping]): Behavior[PingService.Pong.type] = {
    Behaviors.setup { context =&gt;
      pingService ! PingService.Ping(context.self)

      Behaviors.receiveMessage { _ =&gt;
        context.log.info(&quot;{} was ponged!!&quot;, context.self)
        Behaviors.stopped
      }
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/ReceptionistExample.java#L75-L102" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class Pinger {
  private final ActorContext&lt;PingService.Pong&gt; context;
  private final ActorRef&lt;PingService.Ping&gt; pingService;

  private Pinger(ActorContext&lt;PingService.Pong&gt; context, ActorRef&lt;PingService.Ping&gt; pingService) {
    this.context = context;
    this.pingService = pingService;
  }

  public static Behavior&lt;PingService.Pong&gt; create(ActorRef&lt;PingService.Ping&gt; pingService) {
    return Behaviors.setup(
        ctx -&gt; {
          pingService.tell(new PingService.Ping(ctx.getSelf()));
          return new Pinger(ctx, pingService).behavior();
        });
  }

  private Behavior&lt;PingService.Pong&gt; behavior() {
    return Behaviors.receive(PingService.Pong.class)
        .onMessage(PingService.Pong.class, this::onPong)
        .build();
  }

  private Behavior&lt;PingService.Pong&gt; onPong(PingService.Pong msg) {
    context.getLog().info(&quot;{} was ponged!!&quot;, context.getSelf());
    return Behaviors.stopped();
  }
}</code></pre></dd>
</dl>
<p>Finally in the guardian actor we spawn the service as well as subscribing to any actors registering against the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/receptionist/ServiceKey.html" title="org.apache.pekko.actor.typed.receptionist.ServiceKey"><code>ServiceKey</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/receptionist/ServiceKey.html" title="org.apache.pekko.actor.typed.receptionist.ServiceKey"><code>ServiceKey</code></a></span>. Subscribing means that the guardian actor will be informed of any new registrations via a <code>Listing</code> message:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/ReceptionistExample.scala#L64-L79" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object Guardian {
  def apply(): Behavior[Nothing] = {
    Behaviors
      .setup[Receptionist.Listing] { context =&gt;
        context.spawnAnonymous(PingService())
        context.system.receptionist ! Receptionist.Subscribe(PingService.PingServiceKey, context.self)

        Behaviors.receiveMessagePartial[Receptionist.Listing] {
          case PingService.PingServiceKey.Listing(listings) =&gt;
            listings.foreach(ps =&gt; context.spawnAnonymous(Pinger(ps)))
            Behaviors.same
        }
      }
      .narrow
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/ReceptionistExample.java#L106-L141" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class Guardian {

  public static Behavior&lt;Void&gt; create() {
    return Behaviors.setup(
            (ActorContext&lt;Receptionist.Listing&gt; context) -&gt; {
              context
                  .getSystem()
                  .receptionist()
                  .tell(
                      Receptionist.subscribe(
                          PingService.pingServiceKey, context.getSelf().narrow()));
              context.spawnAnonymous(PingService.create());

              return new Guardian(context).behavior();
            })
        .unsafeCast(); // Void
  }

  private final ActorContext&lt;Receptionist.Listing&gt; context;

  private Guardian(ActorContext&lt;Receptionist.Listing&gt; context) {
    this.context = context;
  }

  private Behavior&lt;Receptionist.Listing&gt; behavior() {
    return Behaviors.receive(Receptionist.Listing.class)
        .onMessage(Receptionist.Listing.class, this::onListing)
        .build();
  }

  private Behavior&lt;Receptionist.Listing&gt; onListing(Receptionist.Listing msg) {
    msg.getServiceInstances(PingService.pingServiceKey)
        .forEach(pingService -&gt; context.spawnAnonymous(Pinger.create(pingService)));
    return Behaviors.same();
  }
}</code></pre></dd>
</dl>
<p>Each time a new (which is just a single time in this example) <code>PingService</code> is registered the guardian actor spawns a <code>Pinger</code> for each currently known <code>PingService</code>. The <code>Pinger</code> sends a <code>Ping</code> message and when receiving the <code>Pong</code> reply it stops.</p>
<p>In above example we used <code>Receptionist.Subscribe</code>, but it&rsquo;s also possible to request a single <code>Listing</code> of the current state without receiving further updates by sending the <code>Receptionist.Find</code> message to the receptionist. An example of using <code>Receptionist.Find</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/ReceptionistExample.scala#L83-L104" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object PingManager {
  sealed trait Command
  case object PingAll extends Command
  private case class ListingResponse(listing: Receptionist.Listing) extends Command

  def apply(): Behavior[Command] = {
    Behaviors.setup[Command] { context =&gt;
      val listingResponseAdapter = context.messageAdapter[Receptionist.Listing](ListingResponse.apply)

      context.spawnAnonymous(PingService())

      Behaviors.receiveMessagePartial {
        case PingAll =&gt;
          context.system.receptionist ! Receptionist.Find(PingService.PingServiceKey, listingResponseAdapter)
          Behaviors.same
        case ListingResponse(PingService.PingServiceKey.Listing(listings)) =&gt;
          listings.foreach(ps =&gt; context.spawnAnonymous(Pinger(ps)))
          Behaviors.same
      }
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/ReceptionistExample.java#L145-L196" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class PingManager {

  interface Command {}

  enum PingAll implements Command {
    INSTANCE
  }

  private static class ListingResponse implements Command {
    final Receptionist.Listing listing;

    private ListingResponse(Receptionist.Listing listing) {
      this.listing = listing;
    }
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(context -&gt; new PingManager(context).behavior());
  }

  private final ActorContext&lt;Command&gt; context;
  private final ActorRef&lt;Receptionist.Listing&gt; listingResponseAdapter;

  private PingManager(ActorContext&lt;Command&gt; context) {
    this.context = context;
    this.listingResponseAdapter =
        context.messageAdapter(Receptionist.Listing.class, ListingResponse::new);

    context.spawnAnonymous(PingService.create());
  }

  private Behavior&lt;Command&gt; behavior() {
    return Behaviors.receive(Command.class)
        .onMessage(PingAll.class, notUsed -&gt; onPingAll())
        .onMessage(ListingResponse.class, response -&gt; onListing(response.listing))
        .build();
  }

  private Behavior&lt;Command&gt; onPingAll() {
    context
        .getSystem()
        .receptionist()
        .tell(Receptionist.find(PingService.pingServiceKey, listingResponseAdapter));
    return Behaviors.same();
  }

  private Behavior&lt;Command&gt; onListing(Receptionist.Listing msg) {
    msg.getServiceInstances(PingService.pingServiceKey)
        .forEach(pingService -&gt; context.spawnAnonymous(Pinger.create(pingService)));
    return Behaviors.same();
  }
}</code></pre></dd>
</dl>
<p>Also note how a <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#messageAdapter(java.lang.Class,org.apache.pekko.japi.function.Function)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>messageAdapter</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#messageAdapter[U](f:U=%3ET)(implicitevidence$1:scala.reflect.ClassTag[U]):org.apache.pekko.actor.typed.ActorRef[U]" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>messageAdapter</code></a></span> is used to convert the <code>Receptionist.Listing</code> to a message type that the <code>PingManager</code> understands.</p>
<p>If a server no longer wish to be associated with a service key it can deregister using the command <code>Receptionist.Deregister</code> which will remove the association and inform all subscribers.</p>
<p>The command can optionally send an acknowledgement once the local receptionist has removed the registration. The acknowledgement does not guarantee that all subscribers has seen that the instance has been removed, it may still receive messages from subscribers for some time after this.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/ReceptionistExample.scala#L109" target="_blank" title="Go to snippet source">source</a><code class="language-scala">context.system.receptionist ! Receptionist.Deregister(PingService.PingServiceKey, context.self)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/ReceptionistExample.java#L203-L206" target="_blank" title="Go to snippet source">source</a><code class="language-java">context
    .getSystem()
    .receptionist()
    .tell(Receptionist.deregister(PingService.pingServiceKey, context.getSelf()));</code></pre></dd>
</dl>
<h2><a href="#cluster-receptionist" name="cluster-receptionist" class="anchor"><span class="anchor-link"></span></a>Cluster Receptionist</h2>
<p>The <code>Receptionist</code> also works in a cluster, an actor registered to the receptionist will appear in the receptionist of the other nodes of the cluster.</p>
<p>The state for the receptionist is propagated via <a href="distributed-data.html">distributed data</a> which means that each node will eventually reach the same set of actors per <code>ServiceKey</code>.</p>
<p><code>Subscription</code>s and <code>Find</code> queries to a clustered receptionist will keep track of cluster reachability and only list registered actors that are reachable. The full set of actors, including unreachable ones, is available through <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/typed/receptionist/Receptionist$$Listing.html#allServiceInstances[T](key:org.apache.pekko.actor.typed.receptionist.ServiceKey[T]):Set[org.apache.pekko.actor.typed.ActorRef[T]]" title="pekko.typed.receptionist.Receptionist.Listing"><code>Listing.allServiceInstances</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/actor/typed/receptionist/Receptionist.Listing.html#getAllServiceInstances(org.apache.pekko.actor.typed.receptionist.ServiceKey)" title="pekko.actor.typed.receptionist.Receptionist.Listing"><code>Listing.getAllServiceInstances</code></a></span>.</p>
<p>One important difference from local only receptions are the serialization concerns, all messages sent to and back from an actor on another node must be serializable, see <a href="../serialization.html">serialization</a>.</p>
<h2><a href="#receptionist-scalability" name="receptionist-scalability" class="anchor"><span class="anchor-link"></span></a>Receptionist Scalability</h2>
<p>The receptionist does not scale up to any number of services or very high turnaround of services. It will likely handle up to thousands or tens of thousands of services. Use cases with higher demands the receptionist for initial contact between actors on the nodes while the actual logic of those is up to the applications own actors. </p>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/typed/actor-discovery.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../typed/fault-tolerance.html" title="Fault Tolerance" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Fault Tolerance
</span>
</div>
</a>
<a href="../typed/routers.html" title="Routers" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Routers
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright © 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../assets/js/groups.js"></script>
</body>
</html>
