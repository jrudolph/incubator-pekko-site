<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="The Apache Pekko Actor lifecycle.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="The Apache Pekko Actor lifecycle.">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Actor lifecycle Â· Apache Pekko</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Actor lifecycle
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../downloads.html" class="page">Downloads</a></li>
  <li><a href="../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../typed/index.html" class="page">Actors</a></li>
    <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../stream/index.html" class="page">Streams</a></li>
    <li><a href="../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../project/index.html" class="page">Project Information</a></li>
    <li><a href="../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/actor-lifecycle.html#actor-lifecycle" class="header">Actor lifecycle</a>
  <ul>
    <li><a href="../typed/actor-lifecycle.html#dependency" class="header">Dependency</a></li>
    <li><a href="../typed/actor-lifecycle.html#introduction" class="header">Introduction</a></li>
    <li><a href="../typed/actor-lifecycle.html#creating-actors" class="header">Creating Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html#stopping-actors" class="header">Stopping Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html#watching-actors" class="header">Watching Actors</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/actor-lifecycle.html#actor-lifecycle" class="header">Actor lifecycle</a>
  <ul>
    <li><a href="../typed/actor-lifecycle.html#dependency" class="header">Dependency</a></li>
    <li><a href="../typed/actor-lifecycle.html#introduction" class="header">Introduction</a></li>
    <li><a href="../typed/actor-lifecycle.html#creating-actors" class="header">Creating Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html#stopping-actors" class="header">Stopping Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html#watching-actors" class="header">Watching Actors</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#actor-lifecycle" name="actor-lifecycle" class="anchor"><span class="anchor-link"></span></a>Actor lifecycle</h1>
<p>You are viewing the documentation for the new actor APIs, to view the Pekko Classic documentation, see <a href="../actors.html">Classic Actors</a>.</p>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use Pekko Actor Typed, you must add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val PekkoVersion = "2.6.20+81-523134c3+20230202-1514-SNAPSHOT"
libraryDependencies += "org.apache.pekko" %% "pekko-actor-typed" % PekkoVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
      &lt;artifactId&gt;pekko-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.6.20+81-523134c3+20230202-1514-SNAPSHOT&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
    &lt;artifactId&gt;pekko-actor-typed_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("org.apache.pekko:pekko-bom_${versions.ScalaBinary}:2.6.20+81-523134c3+20230202-1514-SNAPSHOT")

  implementation "org.apache.pekko:pekko-actor-typed_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>An actor is a stateful resource that has to be explicitly started and stopped.</p>
<p>It is important to note that actors do not stop automatically when no longer referenced, every Actor that is created must also explicitly be destroyed. The only simplification is that stopping a parent Actor will also recursively stop all the child Actors that this parent has created. All actors are also stopped automatically when the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> is shut down.</p><div class="callout note "><div class="callout-title">Note</div>
<p>An <code>ActorSystem</code> is a heavyweight structure that will allocate threads, so create one per logical application. Typically one <code>ActorSystem</code> per JVM process.</p></div>
<h2><a href="#creating-actors" name="creating-actors" class="anchor"><span class="anchor-link"></span></a>Creating Actors</h2>
<p>An actor can create, or <em>spawn</em>, an arbitrary number of child actors, which in turn can spawn children of their own, thus forming an actor hierarchy. <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> hosts the hierarchy and there can be only one <em>root actor</em>, an actor at the top of the hierarchy of the <code>ActorSystem</code>. The lifecycle of a child actor is tied to the parent &ndash; a child can stop itself or be stopped at any time but it can never outlive its parent.</p>
<h3><a href="#the-actorcontext" name="the-actorcontext" class="anchor"><span class="anchor-link"></span></a>The ActorContext</h3>
<p>The <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>ActorContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>ActorContext</code></a></span> can be accessed for many purposes such as:</p>
<ul>
  <li>Spawning child actors and supervision</li>
  <li>Watching other actors to receive a <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Terminated.html" title="org.apache.pekko.actor.typed.Terminated"><code>Terminated(otherActor)</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Terminated.html" title="org.apache.pekko.actor.typed.Terminated"><code>Terminated(otherActor)</code></a></span> event should the watched actor stop permanently</li>
  <li>Logging</li>
  <li>Creating message adapters</li>
  <li>Request-response interactions (ask) with another actor</li>
  <li>Access to the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#self:org.apache.pekko.actor.typed.ActorRef[T]" title="pekko.actor.typed.scaladsl.ActorContext"><code>self</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/actor/typed/javadsl/ActorContext.html#getSelf()" title="pekko.actor.typed.javadsl.ActorContext"><code>getSelf()</code></a></span> ActorRef</li>
</ul>
<p>If a behavior needs to use the <code>ActorContext</code>, for example to spawn child actors, or use <span class="group-scala"><code>context.self</code></span><span class="group-java"><code>context.getSelf()</code></span>, it can be obtained by wrapping construction with <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/Behaviors$.html#setup(org.apache.pekko.japi.function.Function)" title="org.apache.pekko.actor.typed.javadsl.Behaviors"><code>Behaviors.setup</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/Behaviors$.html#setup[T](factory:org.apache.pekko.actor.typed.scaladsl.ActorContext[T]=%3Eorg.apache.pekko.actor.typed.Behavior[T]):org.apache.pekko.actor.typed.Behavior[T]" title="org.apache.pekko.actor.typed.scaladsl.Behaviors"><code>Behaviors.setup</code></a></span>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/IntroSpec.scala#L85-L109" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object HelloWorldMain {

  final case class SayHello(name: String)

  def apply(): Behavior[SayHello] =
    Behaviors.setup { context =&gt;
      val greeter = context.spawn(HelloWorld(), &quot;greeter&quot;)

      Behaviors.receiveMessage { message =&gt;
        val replyTo = context.spawn(HelloWorldBot(max = 3), message.name)
        greeter ! HelloWorld.Greet(message.name, replyTo)
        Behaviors.same
      }
    }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/IntroTest.java#L118-L154" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class HelloWorldMain extends AbstractBehavior&lt;HelloWorldMain.SayHello&gt; {
  public static Behavior&lt;SayHello&gt; create() {
    return Behaviors.setup(HelloWorldMain::new);
  }

  private final ActorRef&lt;HelloWorld.Greet&gt; greeter;

  private HelloWorldMain(ActorContext&lt;SayHello&gt; context) {
    super(context);
    greeter = context.spawn(HelloWorld.create(), &quot;greeter&quot;);
  }
}</code></pre></dd>
</dl>
<h4><a href="#actorcontext-thread-safety" name="actorcontext-thread-safety" class="anchor"><span class="anchor-link"></span></a>ActorContext Thread Safety</h4>
<p>Many of the methods in <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>ActorContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>ActorContext</code></a></span> are not thread-safe and</p>
<ul>
  <li>Must not be accessed by threads from <span class="group-scala"><a href="http://www.scala-lang.org/api/2.13.8/scala/concurrent/Future.html" title="scala.concurrent.Future"><code>scala.concurrent.Future</code></a></span><span class="group-java"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" title="java.util.concurrent.CompletionStage"><code>java.util.concurrent.CompletionStage</code></a></span> callbacks</li>
  <li>Must not be shared between several actor instances</li>
  <li>Must only be used in the ordinary actor message processing thread</li>
</ul>
<h3><a href="#the-guardian-actor" name="the-guardian-actor" class="anchor"><span class="anchor-link"></span></a>The Guardian Actor</h3>
<p>The top level actor, also called the user guardian actor, is created along with the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span>. Messages sent to the actor system are directed to the root actor. The root actor is defined by the behavior used to create the <code>ActorSystem</code>, named <code>HelloWorldMain</code> in the example below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/IntroSpec.scala#L258-L264" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>val system: ActorSystem[HelloWorldMain.SayHello] =
  ActorSystem(HelloWorldMain(), &quot;hello&quot;)

system ! HelloWorldMain.SayHello(&quot;World&quot;)
system ! HelloWorldMain.SayHello(&quot;Akka&quot;)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/IntroTest.java#L200-L204" target="_blank" title="Go to snippet source">source</a><code class="language-java">final ActorSystem&lt;HelloWorldMain.SayHello&gt; system =
    ActorSystem.create(HelloWorldMain.create(), &quot;hello&quot;);

system.tell(new HelloWorldMain.SayHello(&quot;World&quot;));
system.tell(new HelloWorldMain.SayHello(&quot;Akka&quot;));</code></pre></dd>
</dl>
<p>For very simple applications the guardian may contain the actual application logic and handle messages. As soon as the application handles more than one concern the guardian should instead just bootstrap the application, spawn the various subsystems as children and monitor their lifecycles.</p>
<p>When the guardian actor stops this will stop the <code>ActorSystem</code>.</p>
<p>When <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html#terminate():Unit" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem.terminate</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html#terminate()" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem.terminate</code></a></span> is invoked the <a href="../coordinated-shutdown.html">Coordinated Shutdown</a> process will stop actors and services in a specific order.</p>
<h3><a href="#spawning-children" name="spawning-children" class="anchor"><span class="anchor-link"></span></a>Spawning Children</h3>
<p>Child actors are created and started with <code>ActorContext</code>&rsquo;s <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#spawn(org.apache.pekko.actor.typed.Behavior,java.lang.String)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>spawn</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#spawn[U](behavior:org.apache.pekko.actor.typed.Behavior[U],name:String,props:org.apache.pekko.actor.typed.Props):org.apache.pekko.actor.typed.ActorRef[U]" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>spawn</code></a></span>. In the example below, when the root actor is started, it spawns a child actor described by the <code>HelloWorld</code> behavior. Additionally, when the root actor receives a <code>SayHello</code> message, it creates a child actor defined by the behavior <code>HelloWorldBot</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/IntroSpec.scala#L85-L109" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object HelloWorldMain {

  final case class SayHello(name: String)

  def apply(): Behavior[SayHello] =
    Behaviors.setup { context =&gt;
      val greeter = context.spawn(HelloWorld(), &quot;greeter&quot;)

      Behaviors.receiveMessage { message =&gt;
        val replyTo = context.spawn(HelloWorldBot(max = 3), message.name)
        greeter ! HelloWorld.Greet(message.name, replyTo)
        Behaviors.same
      }
    }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/IntroTest.java#L118-L154" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class HelloWorldMain extends AbstractBehavior&lt;HelloWorldMain.SayHello&gt; {

  public static class SayHello {
    public final String name;

    public SayHello(String name) {
      this.name = name;
    }
  }

  public static Behavior&lt;SayHello&gt; create() {
    return Behaviors.setup(HelloWorldMain::new);
  }

  private final ActorRef&lt;HelloWorld.Greet&gt; greeter;

  private HelloWorldMain(ActorContext&lt;SayHello&gt; context) {
    super(context);
    greeter = context.spawn(HelloWorld.create(), &quot;greeter&quot;);
  }

  @Override
  public Receive&lt;SayHello&gt; createReceive() {
    return newReceiveBuilder().onMessage(SayHello.class, this::onStart).build();
  }

  private Behavior&lt;SayHello&gt; onStart(SayHello command) {
    ActorRef&lt;HelloWorld.Greeted&gt; replyTo =
        getContext().spawn(HelloWorldBot.create(3), command.name);
    greeter.tell(new HelloWorld.Greet(command.name, replyTo));
    return this;
  }
}</code></pre></dd>
</dl>
<p>To specify a dispatcher when spawning an actor use <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/DispatcherSelector.html" title="org.apache.pekko.actor.typed.DispatcherSelector"><code>DispatcherSelector</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/DispatcherSelector.html" title="org.apache.pekko.actor.typed.DispatcherSelector"><code>DispatcherSelector</code></a></span>. If not specified, the actor will use the default dispatcher, see <a href="dispatchers.html#default-dispatcher">Default dispatcher</a> for details.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/IntroSpec.scala#L123-L136" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def apply(): Behavior[SayHello] =
  Behaviors.setup { context =&gt;
    val dispatcherPath = &quot;pekko.actor.default-blocking-io-dispatcher&quot;

    val props = DispatcherSelector.fromConfig(dispatcherPath)
    val greeter = context.spawn(HelloWorld(), &quot;greeter&quot;, props)

    Behaviors.receiveMessage { message =&gt;
      val replyTo = context.spawn(HelloWorldBot(max = 3), message.name)

      greeter ! HelloWorld.Greet(message.name, replyTo)
      Behaviors.same
    }
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/IntroTest.java#L160-L194" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class HelloWorldMain extends AbstractBehavior&lt;HelloWorldMain.SayHello&gt; {

  // Start message...

  public static Behavior&lt;SayHello&gt; create() {
    return Behaviors.setup(HelloWorldMain::new);
  }

  private final ActorRef&lt;HelloWorld.Greet&gt; greeter;

  private HelloWorldMain(ActorContext&lt;SayHello&gt; context) {
    super(context);

    final String dispatcherPath = &quot;pekko.actor.default-blocking-io-dispatcher&quot;;
    Props greeterProps = DispatcherSelector.fromConfig(dispatcherPath);
    greeter = getContext().spawn(HelloWorld.create(), &quot;greeter&quot;, greeterProps);
  }

  // createReceive ...
}</code></pre></dd>
</dl>
<p>Refer to <a href="actors.html#first-example">Actors</a> for a walk-through of the above examples.</p>
<h3><a href="#spawnprotocol" name="spawnprotocol" class="anchor"><span class="anchor-link"></span></a>SpawnProtocol</h3>
<p>The guardian actor should be responsible for initialization of tasks and create the initial actors of the application, but sometimes you might want to spawn new actors from the outside of the guardian actor. For example creating one actor per HTTP request.</p>
<p>That is not difficult to implement in your behavior, but since this is a common pattern there is a predefined message protocol and implementation of a behavior for this. It can be used as the guardian actor of the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span>, possibly combined with <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/Behaviors$.html#setup(org.apache.pekko.japi.function.Function)" title="org.apache.pekko.actor.typed.javadsl.Behaviors"><code>Behaviors.setup</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/Behaviors$.html#setup[T](factory:org.apache.pekko.actor.typed.scaladsl.ActorContext[T]=%3Eorg.apache.pekko.actor.typed.Behavior[T]):org.apache.pekko.actor.typed.Behavior[T]" title="org.apache.pekko.actor.typed.scaladsl.Behaviors"><code>Behaviors.setup</code></a></span> to start some initial tasks or actors. Child actors can then be started from the outside by <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html#tell(msg:T):Unit" title="org.apache.pekko.actor.typed.ActorRef"><code>tell</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html#tell(T)" title="org.apache.pekko.actor.typed.ActorRef"><code>tell</code></a></span>ing or <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/actor/typed/scaladsl/AskPattern$$Askable.html#ask[Res](replyTo:org.apache.pekko.actor.typed.ActorRef[Res]=%3EReq)(implicittimeout:org.apache.pekko.util.Timeout,implicitscheduler:org.apache.pekko.actor.typed.Scheduler):scala.concurrent.Future[Res]" title="pekko.actor.typed.scaladsl.AskPattern.Askable"><code>ask</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/actor/typed/javadsl/AskPattern.html#ask(org.apache.pekko.actor.typed.RecipientRef,org.apache.pekko.japi.function.Function,java.time.Duration,org.apache.pekko.actor.typed.Scheduler)" title="pekko.actor.typed.javadsl.AskPattern"><code>ask</code></a></span>ing <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/SpawnProtocol$$Spawn.html" title="org.apache.pekko.actor.typed.SpawnProtocol.Spawn"><code>SpawnProtocol.Spawn</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/SpawnProtocol$$Spawn.html" title="org.apache.pekko.actor.typed.SpawnProtocol.Spawn"><code>SpawnProtocol.Spawn</code></a></span> to the actor reference of the system. Using <code>ask</code> is similar to how <code>ActorSystem.actorOf</code> can be used in classic actors with the difference that a <span class="group-scala"><a href="http://www.scala-lang.org/api/2.13.8/scala/concurrent/Future.html" title="scala.concurrent.Future"><code>Future</code></a></span><span class="group-java"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" title="java.util.concurrent.CompletionStage"><code>CompletionStage</code></a></span> of the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span> is returned.</p>
<p>The guardian behavior can be defined as:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/SpawnProtocolDocSpec.scala#L28-L33" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.typed.Behavior
import pekko.actor.typed.SpawnProtocol
import pekko.actor.typed.scaladsl.Behaviors
import pekko.actor.typed.scaladsl.LoggerOps

object HelloWorldMain {
  def apply(): Behavior[SpawnProtocol.Command] =
    Behaviors.setup { context =&gt;
      // Start initial tasks
      // context.spawn(...)

      SpawnProtocol()
    }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/SpawnProtocolDocTest.java#L22-L25" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.typed.Behavior;
import org.apache.pekko.actor.typed.SpawnProtocol;
import org.apache.pekko.actor.typed.javadsl.Behaviors;

public abstract class HelloWorldMain {
  private HelloWorldMain() {}

  public static Behavior&lt;SpawnProtocol.Command&gt; create() {
    return Behaviors.setup(
        context -&gt; {
          // Start initial tasks
          // context.spawn(...)

          return SpawnProtocol.create();
        });
  }
}</code></pre></dd>
</dl>
<p>and the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> can be created with that <code>main</code> behavior and asked to spawn other actors:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/SpawnProtocolDocSpec.scala#L37-L42" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.typed.ActorRef
import pekko.actor.typed.ActorSystem
import pekko.actor.typed.Props
import pekko.util.Timeout


implicit val system: ActorSystem[SpawnProtocol.Command] =
  ActorSystem(HelloWorldMain(), &quot;hello&quot;)

// needed in implicit scope for ask (?)
import pekko.actor.typed.scaladsl.AskPattern._
implicit val ec: ExecutionContext = system.executionContext
implicit val timeout: Timeout = Timeout(3.seconds)

val greeter: Future[ActorRef[HelloWorld.Greet]] =
  system.ask(SpawnProtocol.Spawn(behavior = HelloWorld(), name = &quot;greeter&quot;, props = Props.empty, _))

val greetedBehavior = Behaviors.receive[HelloWorld.Greeted] { (context, message) =&gt;
  context.log.info2(&quot;Greeting for {} from {}&quot;, message.whom, message.from)
  Behaviors.stopped
}

val greetedReplyTo: Future[ActorRef[HelloWorld.Greeted]] =
  system.ask(SpawnProtocol.Spawn(greetedBehavior, name = &quot;&quot;, props = Props.empty, _))

for (greeterRef &lt;- greeter; replyToRef &lt;- greetedReplyTo) {
  greeterRef ! HelloWorld.Greet(&quot;Akka&quot;, replyToRef)
}
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/SpawnProtocolDocTest.java#L29-L33" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.typed.ActorRef;
import org.apache.pekko.actor.typed.ActorSystem;
import org.apache.pekko.actor.typed.Props;
import org.apache.pekko.actor.typed.javadsl.AskPattern;

final ActorSystem&lt;SpawnProtocol.Command&gt; system =
    ActorSystem.create(HelloWorldMain.create(), &quot;hello&quot;);
final Duration timeout = Duration.ofSeconds(3);

CompletionStage&lt;ActorRef&lt;HelloWorld.Greet&gt;&gt; greeter =
    AskPattern.ask(
        system,
        replyTo -&gt;
            new SpawnProtocol.Spawn&lt;&gt;(HelloWorld.create(), &quot;greeter&quot;, Props.empty(), replyTo),
        timeout,
        system.scheduler());

Behavior&lt;HelloWorld.Greeted&gt; greetedBehavior =
    Behaviors.receive(
        (context, message) -&gt; {
          context.getLog().info(&quot;Greeting for {} from {}&quot;, message.whom, message.from);
          return Behaviors.stopped();
        });

CompletionStage&lt;ActorRef&lt;HelloWorld.Greeted&gt;&gt; greetedReplyTo =
    AskPattern.ask(
        system,
        replyTo -&gt; new SpawnProtocol.Spawn&lt;&gt;(greetedBehavior, &quot;&quot;, Props.empty(), replyTo),
        timeout,
        system.scheduler());

greeter.whenComplete(
    (greeterRef, exc) -&gt; {
      if (exc == null) {
        greetedReplyTo.whenComplete(
            (greetedReplyToRef, exc2) -&gt; {
              if (exc2 == null) {
                greeterRef.tell(new HelloWorld.Greet(&quot;Akka&quot;, greetedReplyToRef));
              }
            });
      }
    });
</code></pre></dd>
</dl>
<p>The <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/SpawnProtocol$.html" title="org.apache.pekko.actor.typed.SpawnProtocol"><code>SpawnProtocol</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/SpawnProtocol$.html" title="org.apache.pekko.actor.typed.SpawnProtocol"><code>SpawnProtocol</code></a></span> can also be used at other places in the actor hierarchy. It doesn&rsquo;t have to be the root guardian actor.</p>
<p>A way to find running actors is described in <a href="actor-discovery.html">Actor discovery</a>.</p>
<h2><a href="#stopping-actors" name="stopping-actors" class="anchor"><span class="anchor-link"></span></a>Stopping Actors</h2>
<p>An actor can stop itself by returning <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/Behaviors$.html#stopped()" title="org.apache.pekko.actor.typed.javadsl.Behaviors"><code>Behaviors.stopped</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/Behaviors$.html#stopped[T]:org.apache.pekko.actor.typed.Behavior[T]" title="org.apache.pekko.actor.typed.scaladsl.Behaviors"><code>Behaviors.stopped</code></a></span> as the next behavior.</p>
<p>A child actor can be forced to stop after it finishes processing its current message by using the <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#stop(org.apache.pekko.actor.typed.ActorRef)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>stop</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#stop[U](child:org.apache.pekko.actor.typed.ActorRef[U]):Unit" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>stop</code></a></span> method of the <code>ActorContext</code> from the parent actor. Only child actors can be stopped in that way.</p>
<p>All child actors will be stopped when their parent is stopped.</p>
<p>When an actor is stopped, it receives the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/PostStop.html" title="org.apache.pekko.actor.typed.PostStop"><code>PostStop</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/PostStop.html" title="org.apache.pekko.actor.typed.PostStop"><code>PostStop</code></a></span> signal that can be used for cleaning up resources.</p>
<p>Here is an illustrating example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/GracefulStopDocSpec.scala#L17-L21" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.typed.Behavior
import pekko.actor.typed.scaladsl.Behaviors
import pekko.actor.typed.{ ActorSystem, PostStop }


object MasterControlProgram {
  sealed trait Command
  final case class SpawnJob(name: String) extends Command
  case object GracefulShutdown extends Command

  def apply(): Behavior[Command] = {
    Behaviors
      .receive[Command] { (context, message) =&gt;
        message match {
          case SpawnJob(jobName) =&gt;
            context.log.info(&quot;Spawning job {}!&quot;, jobName)
            context.spawn(Job(jobName), name = jobName)
            Behaviors.same
          case GracefulShutdown =&gt;
            context.log.info(&quot;Initiating graceful shutdown...&quot;)
            // Here it can perform graceful stop (possibly asynchronous) and when completed
            // return `Behaviors.stopped` here or after receiving another message.
            Behaviors.stopped
        }
      }
      .receiveSignal {
        case (context, PostStop) =&gt;
          context.log.info(&quot;Master Control Program stopped&quot;)
          Behaviors.same
      }
  }
}

object Job {
  sealed trait Command

  def apply(name: String): Behavior[Command] = {
    Behaviors.receiveSignal[Command] {
      case (context, PostStop) =&gt;
        context.log.info(&quot;Worker {} stopped&quot;, name)
        Behaviors.same
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/GracefulStopDocTest.java#L17-L27" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>import java.util.concurrent.TimeUnit;

import org.apache.pekko.actor.typed.ActorSystem;
import org.apache.pekko.actor.typed.Behavior;
import org.apache.pekko.actor.typed.PostStop;
import org.apache.pekko.actor.typed.javadsl.AbstractBehavior;
import org.apache.pekko.actor.typed.javadsl.ActorContext;
import org.apache.pekko.actor.typed.javadsl.Behaviors;
import org.apache.pekko.actor.typed.javadsl.Receive;


public class MasterControlProgram extends AbstractBehavior&lt;MasterControlProgram.Command&gt; {

  interface Command {}

  public static final class SpawnJob implements Command {
    public final String name;

    public SpawnJob(String name) {
      this.name = name;
    }
  }

  public enum GracefulShutdown implements Command {
    INSTANCE
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(MasterControlProgram::new);
  }

  public MasterControlProgram(ActorContext&lt;Command&gt; context) {
    super(context);
  }

  @Override
  public Receive&lt;Command&gt; createReceive() {
    return newReceiveBuilder()
        .onMessage(SpawnJob.class, this::onSpawnJob)
        .onMessage(GracefulShutdown.class, message -&gt; onGracefulShutdown())
        .onSignal(PostStop.class, signal -&gt; onPostStop())
        .build();
  }

  private Behavior&lt;Command&gt; onSpawnJob(SpawnJob message) {
    getContext().getSystem().log().info(&quot;Spawning job {}!&quot;, message.name);
    getContext().spawn(Job.create(message.name), message.name);
    return this;
  }

  private Behavior&lt;Command&gt; onGracefulShutdown() {
    getContext().getSystem().log().info(&quot;Initiating graceful shutdown...&quot;);

    // Here it can perform graceful stop (possibly asynchronous) and when completed
    // return `Behaviors.stopped()` here or after receiving another message.
    return Behaviors.stopped();
  }

  private Behavior&lt;Command&gt; onPostStop() {
    getContext().getSystem().log().info(&quot;Master Control Program stopped&quot;);
    return this;
  }
}

public class Job extends AbstractBehavior&lt;Job.Command&gt; {

  interface Command {}

  public static Behavior&lt;Command&gt; create(String name) {
    return Behaviors.setup(context -&gt; new Job(context, name));
  }

  private final String name;

  public Job(ActorContext&lt;Command&gt; context, String name) {
    super(context);
    this.name = name;
  }

  @Override
  public Receive&lt;Job.Command&gt; createReceive() {
    return newReceiveBuilder().onSignal(PostStop.class, postStop -&gt; onPostStop()).build();
  }

  private Behavior&lt;Command&gt; onPostStop() {
    getContext().getSystem().log().info(&quot;Worker {} stopped&quot;, name);
    return this;
  }
}</code></pre></dd>
</dl>
<p>When cleaning up resources from <code>PostStop</code> you should also consider doing the same for the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/PreRestart.html" title="org.apache.pekko.actor.typed.PreRestart"><code>PreRestart</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/PreRestart.html" title="org.apache.pekko.actor.typed.PreRestart"><code>PreRestart</code></a></span> signal, which is emitted when the <a href="fault-tolerance.html#the-prerestart-signal">actor is restarted</a>. Note that <code>PostStop</code> is not emitted for a restart. </p>
<h2><a href="#watching-actors" name="watching-actors" class="anchor"><span class="anchor-link"></span></a>Watching Actors</h2>
<p>In order to be notified when another actor terminates (i.e. stops permanently, not temporary failure and restart), an actor can <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#watch(org.apache.pekko.actor.typed.ActorRef)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>watch</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#watch[U](other:org.apache.pekko.actor.typed.ActorRef[U]):Unit" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>watch</code></a></span> another actor. It will receive the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Terminated.html" title="org.apache.pekko.actor.typed.Terminated"><code>Terminated</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Terminated.html" title="org.apache.pekko.actor.typed.Terminated"><code>Terminated</code></a></span> signal upon termination (see <a href="actor-lifecycle.html#stopping-actors">Stopping Actors</a>) of the watched actor.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/GracefulStopDocSpec.scala#L83-L105" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>object MasterControlProgram {
  sealed trait Command
  final case class SpawnJob(name: String) extends Command

  def apply(): Behavior[Command] = {
    Behaviors
      .receive[Command] { (context, message) =&gt;
        message match {
          case SpawnJob(jobName) =&gt;
            context.log.info(&quot;Spawning job {}!&quot;, jobName)
            val job = context.spawn(Job(jobName), name = jobName)
            context.watch(job)
            Behaviors.same
        }
      }
      .receiveSignal {
        case (context, Terminated(ref)) =&gt;
          context.log.info(&quot;Job stopped: {}&quot;, ref.path.name)
          Behaviors.same
      }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/GracefulStopDocTest.java#L137-L176" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class MasterControlProgram extends AbstractBehavior&lt;MasterControlProgram.Command&gt; {

  interface Command {}

  public static final class SpawnJob implements Command {
    public final String name;

    public SpawnJob(String name) {
      this.name = name;
    }
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(MasterControlProgram::new);
  }

  public MasterControlProgram(ActorContext&lt;Command&gt; context) {
    super(context);
  }

  @Override
  public Receive&lt;Command&gt; createReceive() {
    return newReceiveBuilder()
        .onMessage(SpawnJob.class, this::onSpawnJob)
        .onSignal(Terminated.class, this::onTerminated)
        .build();
  }

  private Behavior&lt;Command&gt; onSpawnJob(SpawnJob message) {
    getContext().getSystem().log().info(&quot;Spawning job {}!&quot;, message.name);
    ActorRef&lt;Job.Command&gt; job = getContext().spawn(Job.create(message.name), message.name);
    getContext().watch(job);
    return this;
  }

  private Behavior&lt;Command&gt; onTerminated(Terminated terminated) {
    getContext().getSystem().log().info(&quot;Job stopped: {}&quot;, terminated.getRef().path().name());
    return this;
  }
}</code></pre></dd>
</dl>
<p>An alternative to <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#watch(org.apache.pekko.actor.typed.ActorRef)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>watch</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#watch[U](other:org.apache.pekko.actor.typed.ActorRef[U]):Unit" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>watch</code></a></span> is <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#watchWith(org.apache.pekko.actor.typed.ActorRef,T)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>watchWith</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#watchWith[U](other:org.apache.pekko.actor.typed.ActorRef[U],msg:T):Unit" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>watchWith</code></a></span>, which allows specifying a custom message instead of the <code>Terminated</code>. This is often preferred over using <code>watch</code> and the <code>Terminated</code> signal because additional information can be included in the message that can be used later when receiving it.</p>
<p>Similar example as above, but using <code>watchWith</code> and replies to the original requestor when the job has finished.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/GracefulStopDocSpec.scala#L111-L133" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>object MasterControlProgram {
  sealed trait Command
  final case class SpawnJob(name: String, replyToWhenDone: ActorRef[JobDone]) extends Command
  final case class JobDone(name: String)
  private final case class JobTerminated(name: String, replyToWhenDone: ActorRef[JobDone]) extends Command

  def apply(): Behavior[Command] = {
    Behaviors.receive { (context, message) =&gt;
      message match {
        case SpawnJob(jobName, replyToWhenDone) =&gt;
          context.log.info(&quot;Spawning job {}!&quot;, jobName)
          val job = context.spawn(Job(jobName), name = jobName)
          context.watchWith(job, JobTerminated(jobName, replyToWhenDone))
          Behaviors.same
        case JobTerminated(jobName, replyToWhenDone) =&gt;
          context.log.info(&quot;Job stopped: {}&quot;, jobName)
          replyToWhenDone ! JobDone(jobName)
          Behaviors.same
      }
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/GracefulStopDocTest.java#L182-L242" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class MasterControlProgram extends AbstractBehavior&lt;MasterControlProgram.Command&gt; {

  interface Command {}

  public static final class SpawnJob implements Command {
    public final String name;
    public final ActorRef&lt;JobDone&gt; replyToWhenDone;

    public SpawnJob(String name, ActorRef&lt;JobDone&gt; replyToWhenDone) {
      this.name = name;
      this.replyToWhenDone = replyToWhenDone;
    }
  }

  public static final class JobDone {
    public final String name;

    public JobDone(String name) {
      this.name = name;
    }
  }

  private static final class JobTerminated implements Command {
    final String name;
    final ActorRef&lt;JobDone&gt; replyToWhenDone;

    JobTerminated(String name, ActorRef&lt;JobDone&gt; replyToWhenDone) {
      this.name = name;
      this.replyToWhenDone = replyToWhenDone;
    }
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(MasterControlProgram::new);
  }

  public MasterControlProgram(ActorContext&lt;Command&gt; context) {
    super(context);
  }

  @Override
  public Receive&lt;Command&gt; createReceive() {
    return newReceiveBuilder()
        .onMessage(SpawnJob.class, this::onSpawnJob)
        .onMessage(JobTerminated.class, this::onJobTerminated)
        .build();
  }

  private Behavior&lt;Command&gt; onSpawnJob(SpawnJob message) {
    getContext().getSystem().log().info(&quot;Spawning job {}!&quot;, message.name);
    ActorRef&lt;Job.Command&gt; job = getContext().spawn(Job.create(message.name), message.name);
    getContext().watchWith(job, new JobTerminated(message.name, message.replyToWhenDone));
    return this;
  }

  private Behavior&lt;Command&gt; onJobTerminated(JobTerminated terminated) {
    getContext().getSystem().log().info(&quot;Job stopped: {}&quot;, terminated.name);
    terminated.replyToWhenDone.tell(new JobDone(terminated.name));
    return this;
  }
}</code></pre></dd>
</dl>
<p>Note how the <code>replyToWhenDone</code> is included in the <code>watchWith</code> message and then used later when receiving the <code>JobTerminated</code> message. </p>
<p>The watched actor can be any <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span>, it doesn&rsquo;t have to be a child actor as in the above example.</p>
<p>It should be noted that the terminated message is generated independent of the order in which registration and termination occur. In particular, the watching actor will receive a terminated message even if the watched actor has already been terminated at the time of registration.</p>
<p>Registering multiple times does not necessarily lead to multiple messages being generated, but there is no guarantee that only exactly one such message is received: if termination of the watched actor has generated and queued the message, and another registration is done before this message has been processed, then a second message will be queued, because registering for monitoring of an already terminated actor leads to the immediate generation of the terminated message.</p>
<p>It is also possible to deregister from watching another actorâs liveliness using <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/javadsl/ActorContext.html#unwatch(org.apache.pekko.actor.typed.ActorRef)" title="org.apache.pekko.actor.typed.javadsl.ActorContext"><code>context.unwatch(target)</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/scaladsl/ActorContext.html#unwatch[U](other:org.apache.pekko.actor.typed.ActorRef[U]):Unit" title="org.apache.pekko.actor.typed.scaladsl.ActorContext"><code>context.unwatch(target)</code></a></span>. This works even if the terminated message has already been enqueued in the mailbox; after calling <code>unwatch</code> no terminated message for that actor will be processed anymore.</p>
<p>The terminated message is also sent when the watched actor is on a node that has been removed from the <a href="cluster.html">Cluster</a>.</p>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/typed/actor-lifecycle.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../typed/actors.html" title="Introduction to Actors" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Introduction to Actors
</span>
</div>
</a>
<a href="../typed/interaction-patterns.html" title="Interaction Patterns" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Interaction Patterns
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright Â© 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../assets/js/groups.js"></script>
</body>
</html>
