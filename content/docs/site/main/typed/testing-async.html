<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Asynchronous testing Â· Apache Pekko</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Asynchronous testing
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../downloads.html" class="page">Downloads</a></li>
  <li><a href="../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../typed/index.html" class="page">Actors</a></li>
    <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../stream/index.html" class="page">Streams</a></li>
    <li><a href="../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../project/index.html" class="page">Project Information</a></li>
    <li><a href="../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/testing-async.html#asynchronous-testing" class="header">Asynchronous testing</a>
  <ul>
    <li><a href="../typed/testing-async.html#basic-example" class="header">Basic example</a></li>
    <li><a href="../typed/testing-async.html#observing-mocked-behavior" class="header">Observing mocked behavior</a></li>
    <li><a href="../typed/testing-async.html#test-framework-integration" class="header">Test framework integration</a></li>
    <li><a href="../typed/testing-async.html#configuration" class="header">Configuration</a></li>
    <li><a href="../typed/testing-async.html#controlling-the-scheduler" class="header">Controlling the scheduler</a></li>
    <li><a href="../typed/testing-async.html#test-of-logging" class="header">Test of logging</a></li>
    <li><a href="../typed/testing-async.html#silence-logging-output-from-tests" class="header">Silence logging output from tests</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/testing-async.html#asynchronous-testing" class="header">Asynchronous testing</a>
  <ul>
    <li><a href="../typed/testing-async.html#basic-example" class="header">Basic example</a></li>
    <li><a href="../typed/testing-async.html#observing-mocked-behavior" class="header">Observing mocked behavior</a></li>
    <li><a href="../typed/testing-async.html#test-framework-integration" class="header">Test framework integration</a></li>
    <li><a href="../typed/testing-async.html#configuration" class="header">Configuration</a></li>
    <li><a href="../typed/testing-async.html#controlling-the-scheduler" class="header">Controlling the scheduler</a></li>
    <li><a href="../typed/testing-async.html#test-of-logging" class="header">Test of logging</a></li>
    <li><a href="../typed/testing-async.html#silence-logging-output-from-tests" class="header">Silence logging output from tests</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h2><a href="#asynchronous-testing" name="asynchronous-testing" class="anchor"><span class="anchor-link"></span></a>Asynchronous testing</h2>
<p>You are viewing the documentation for the new actor APIs, to view the Pekko Classic documentation, see <a href="../testing.html">Classic Testing</a>.</p>
<p>Asynchronous testing uses a real <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> that allows you to test your Actors in a more realistic environment.</p>
<p>The minimal setup consists of the test procedure, which provides the desired stimuli, the actor under test, and an actor receiving replies. Bigger systems replace the actor under test with a network of actors, apply stimuli at varying injection points and arrange results to be sent from different emission points, but the basic principle stays the same in that a single procedure drives the test.</p>
<h3><a href="#basic-example" name="basic-example" class="anchor"><span class="anchor-link"></span></a>Basic example</h3>
<p>Actor under test:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L41-L50" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object Echo {
  case class Ping(message: String, response: ActorRef[Pong])
  case class Pong(message: String)

  def apply(): Behavior[Ping] = Behaviors.receiveMessage {
    case Ping(m, replyTo) =&gt;
      replyTo ! Pong(m)
      Behaviors.same
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L48-L90" target="_blank" title="Go to snippet source">source</a><code class="language-java">public static class Echo {
  public static class Ping {
    public final String message;
    public final ActorRef&lt;Pong&gt; replyTo;

    public Ping(String message, ActorRef&lt;Pong&gt; replyTo) {
      this.message = message;
      this.replyTo = replyTo;
    }
  }

  public static class Pong {
    public final String message;

    public Pong(String message) {
      this.message = message;
    }

    @Override
    public boolean equals(Object o) {
      if (this == o) return true;
      if (!(o instanceof Pong)) return false;
      Pong pong = (Pong) o;
      return message.equals(pong.message);
    }

    @Override
    public int hashCode() {
      return Objects.hash(message);
    }
  }

  public static Behavior&lt;Ping&gt; create() {
    return Behaviors.receive(Ping.class)
        .onMessage(
            Ping.class,
            ping -&gt; {
              ping.replyTo.tell(new Pong(ping.message));
              return Behaviors.same();
            })
        .build();
  }
}</code></pre></dd>
</dl>
<p>Tests create an instance of <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/javadsl/ActorTestKit.html" title="org.apache.pekko.actor.testkit.typed.javadsl.ActorTestKit"><code>ActorTestKit</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/scaladsl/ActorTestKit.html" title="org.apache.pekko.actor.testkit.typed.scaladsl.ActorTestKit"><code>ActorTestKit</code></a></span>. This provides access to:</p>
<ul>
  <li>An ActorSystem</li>
  <li>Methods for spawning Actors. These are created under the special testkit user guardian</li>
  <li>A method to shut down the ActorSystem from the test suite</li>
</ul>
<p>This first example is using the &ldquo;raw&rdquo; <code>ActorTestKit</code> but if you are using <span class="group-scala">ScalaTest</span><span class="group-java">JUnit</span> you can simplify the tests by using the <a href="testing-async.html#test-framework-integration">Test framework integration</a>. It&rsquo;s still good to read this section to understand how it works.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L20-L151" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko.actor.testkit.typed.scaladsl.ActorTestKit

import org.scalatest.BeforeAndAfterAll
import org.scalatest.matchers.should.Matchers
import org.scalatest.wordspec.AnyWordSpec

class AsyncTestingExampleSpec
    extends AnyWordSpec
    with BeforeAndAfterAll
    with Matchers {
  val testKit = ActorTestKit()
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L22-L207" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.testkit.typed.javadsl.ActorTestKit;

public class AsyncTestingExampleTest
{
  static final ActorTestKit testKit = ActorTestKit.create();
}</code></pre></dd>
</dl>
<p>Your test is responsible for shutting down the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> e.g. using <span class="group-scala"><code>BeforeAndAfterAll</code> when using ScalaTest</span><span class="group-java"><code>@AfterClass</code> when using JUnit</span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L148" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def afterAll(): Unit = testKit.shutdownTestKit()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L130-L133" target="_blank" title="Go to snippet source">source</a><code class="language-java">@AfterClass
public static void cleanup() {
  testKit.shutdownTestKit();
}</code></pre></dd>
</dl>
<p>The following demonstrates:</p>
<ul>
  <li>Creating an actor from the <code>TestKit</code>&rsquo;s system using <code>spawn</code></li>
  <li>Creating a <code>TestProbe</code></li>
  <li>Verifying that the actor under test responds via the <code>TestProbe</code></li>
</ul>
<p>Note that it is possible to use a <code>TestProbe</code> directly as a <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/RecipientRef.html" title="org.apache.pekko.actor.typed.RecipientRef"><code>RecipientRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/RecipientRef.html" title="org.apache.pekko.actor.typed.RecipientRef"><code>RecipientRef</code></a></span> (a common supertype of <code>ActorRef</code> and <a href="cluster-sharding.html">Cluster Sharding</a> <code>EntityRef</code>), in cases where a message protocol uses <code>RecipientRef</code> instead of specifying <code>ActorRef</code> or <code>EntityRef</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L87-L90" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val pinger = testKit.spawn(Echo(), &quot;ping&quot;)
val probe = testKit.createTestProbe[Echo.Pong]()
pinger ! Echo.Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Echo.Pong(&quot;hello&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L139-L142" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create(), &quot;ping&quot;);
TestProbe&lt;Echo.Pong&gt; probe = testKit.createTestProbe();
pinger.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Echo.Pong(&quot;hello&quot;));</code></pre></dd>
</dl>
<p>Actors can also be spawned anonymously:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L96" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val pinger = testKit.spawn(Echo())</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L149" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create());</code></pre></dd>
</dl>
<p>Note that you can add <code>import testKit._</code> to get access to the <code>spawn</code> and <code>createTestProbe</code> methods at the top level without prefixing them with <code>testKit</code>.</p>
<h4><a href="#stopping-actors" name="stopping-actors" class="anchor"><span class="anchor-link"></span></a>Stopping actors</h4>
<p>The method will wait until the actor stops or throw an assertion error in case of a timeout.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L107-L116" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val pinger1 = testKit.spawn(Echo(), &quot;pinger&quot;)
pinger1 ! Echo.Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Echo.Pong(&quot;hello&quot;))
testKit.stop(pinger1) // Uses default timeout

// Immediately creating an actor with the same name
val pinger2 = testKit.spawn(Echo(), &quot;pinger&quot;)
pinger2 ! Echo.Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Echo.Pong(&quot;hello&quot;))
testKit.stop(pinger2, 10.seconds) // Custom timeout</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L160-L169" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef&lt;Echo.Ping&gt; pinger1 = testKit.spawn(Echo.create(), &quot;pinger&quot;);
pinger1.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
testKit.stop(pinger1);

// Immediately creating an actor with the same name
ActorRef&lt;Echo.Ping&gt; pinger2 = testKit.spawn(Echo.create(), &quot;pinger&quot;);
pinger2.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
testKit.stop(pinger2, Duration.ofSeconds(10));</code></pre></dd>
</dl>
<p>The <code>stop</code> method can only be used for actors that were spawned by the same <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/javadsl/ActorTestKit.html" title="org.apache.pekko.actor.testkit.typed.javadsl.ActorTestKit"><code>ActorTestKit</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/scaladsl/ActorTestKit.html" title="org.apache.pekko.actor.testkit.typed.scaladsl.ActorTestKit"><code>ActorTestKit</code></a></span>. Other actors will not be stopped by that method.</p>
<h3><a href="#observing-mocked-behavior" name="observing-mocked-behavior" class="anchor"><span class="anchor-link"></span></a>Observing mocked behavior</h3>
<p>When testing a component (which may be an actor or not) that interacts with other actors it can be useful to not have to run the other actors it depends on. Instead, you might want to create mock behaviors that accept and possibly respond to messages in the same way the other actor would do but without executing any actual logic. In addition to this it can also be useful to observe those interactions to assert that the component under test did send the expected messages. This allows the same kinds of tests as classic <code>TestActor</code>/<code>Autopilot</code>.</p>
<p>As an example, let&rsquo;s assume we&rsquo;d like to test the following component:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L54-L66" target="_blank" title="Go to snippet source">source</a><code class="language-scala">case class Message(i: Int, replyTo: ActorRef[Try[Int]])

class Producer(publisher: ActorRef[Message])(implicit scheduler: Scheduler) {

  def produce(messages: Int)(implicit timeout: Timeout): Unit = {
    (0 until messages).foreach(publish)
  }

  private def publish(i: Int)(implicit timeout: Timeout): Future[Try[Int]] = {
    publisher.ask(ref =&gt; Message(i, ref))
  }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L94-L126" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>static class Message {
  int i;
  ActorRef&lt;Integer&gt; replyTo;

  Message(int i, ActorRef&lt;Integer&gt; replyTo) {
    this.i = i;
    this.replyTo = replyTo;
  }
}

public static class Producer {

  private Scheduler scheduler;
  private ActorRef&lt;Message&gt; publisher;

  Producer(Scheduler scheduler, ActorRef&lt;Message&gt; publisher) {
    this.scheduler = scheduler;
    this.publisher = publisher;
  }

  public void produce(int messages) {
    IntStream.range(0, messages).forEach(this::publish);
  }

  private CompletionStage&lt;Integer&gt; publish(int i) {
    return AskPattern.ask(
        publisher,
        (ActorRef&lt;Integer&gt; ref) -&gt; new Message(i, ref),
        Duration.ofSeconds(3),
        scheduler);
  }
}</code></pre></dd>
</dl>
<p>In our test, we create a mocked <code>publisher</code> actor. Additionally we use <code>Behaviors.monitor</code> with a <code>TestProbe</code> in order to be able to verify the interaction of the <code>producer</code> with the <code>publisher</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L123-L142" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import testKit._

// simulate the happy path
val mockedBehavior = Behaviors.receiveMessage[Message] { msg =&gt;
  msg.replyTo ! Success(msg.i)
  Behaviors.same
}
val probe = testKit.createTestProbe[Message]()
val mockedPublisher = testKit.spawn(Behaviors.monitor(probe.ref, mockedBehavior))

// test our component
val producer = new Producer(mockedPublisher)
val messages = 3
producer.produce(messages)

// verify expected behavior
for (i &lt;- 0 until messages) {
  val msg = probe.expectMessageType[Message]
  msg.i shouldBe i
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L176-L198" target="_blank" title="Go to snippet source">source</a><code class="language-java">// simulate the happy path
Behavior&lt;Message&gt; mockedBehavior =
    Behaviors.receiveMessage(
        message -&gt; {
          message.replyTo.tell(message.i);
          return Behaviors.same();
        });
TestProbe&lt;Message&gt; probe = testKit.createTestProbe();
ActorRef&lt;Message&gt; mockedPublisher =
    testKit.spawn(Behaviors.monitor(Message.class, probe.ref(), mockedBehavior));

// test our component
Producer producer = new Producer(testKit.scheduler(), mockedPublisher);
int messages = 3;
producer.produce(messages);

// verify expected behavior
IntStream.range(0, messages)
    .forEach(
        i -&gt; {
          Message msg = probe.expectMessageClass(Message.class);
          assertEquals(i, msg.i);
        });</code></pre></dd>
</dl>
<h3><a href="#test-framework-integration" name="test-framework-integration" class="anchor"><span class="anchor-link"></span></a>Test framework integration</h3><div class="group-java">
<p>If you are using JUnit you can use <a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/actor/testkit/typed/javadsl/TestKitJunitResource.html" title="pekko.actor.testkit.typed.javadsl.TestKitJunitResource"><code>TestKitJunitResource</code></a> to have the async test kit automatically shutdown when the test is complete.</p>
<p>Note that the dependency on JUnit is marked as optional from the test kit module, so your project must explicitly include a dependency on JUnit to use this.</p></div><div class="group-scala">
<p>If you are using ScalaTest you can extend <a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/actor/testkit/typed/scaladsl/ScalaTestWithActorTestKit.html" title="pekko.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit"><code>ScalaTestWithActorTestKit</code></a> to have the async test kit automatically shutdown when the test is complete. This is done in <code>afterAll</code> from the <code>BeforeAndAfterAll</code> trait. If you override that method you should call <code>super.afterAll</code> to shutdown the test kit.</p>
<p>Note that the dependency on ScalaTest is marked as optional from the test kit module, so your project must explicitly include a dependency on ScalaTest to use this.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/ScalaTestIntegrationExampleSpec.scala#L23-L41" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import pekko.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import org.scalatest.wordspec.AnyWordSpecLike

class ScalaTestIntegrationExampleSpec extends ScalaTestWithActorTestKit with AnyWordSpecLike {

  &quot;Something&quot; must {
    &quot;behave correctly&quot; in {
      val pinger = testKit.spawn(Echo(), &quot;ping&quot;)
      val probe = testKit.createTestProbe[Echo.Pong]()
      pinger ! Echo.Ping(&quot;hello&quot;, probe.ref)
      probe.expectMessage(Echo.Pong(&quot;hello&quot;))
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/JunitIntegrationExampleTest.java#L22-L44" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.testkit.typed.javadsl.TestKitJunitResource;
import org.apache.pekko.actor.testkit.typed.javadsl.TestProbe;
import org.apache.pekko.actor.typed.ActorRef;
import org.junit.ClassRule;
import org.junit.Test;

public class JunitIntegrationExampleTest {

  @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource();


  @Test
  public void testSomething() {
    ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create(), &quot;ping&quot;);
    TestProbe&lt;Echo.Pong&gt; probe = testKit.createTestProbe();
    pinger.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
    probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
  }
}</code></pre></dd>
</dl>
<h3><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h3>
<p>By default the <code>ActorTestKit</code> loads configuration from <code>application-test.conf</code> if that exists, otherwise it is using default configuration from the reference.conf resources that ship with the Pekko libraries. The application.conf of your project is not used in this case. A specific configuration can be given as parameter when creating the TestKit.</p>
<p>If you prefer to use <code>application.conf</code> you can pass that as the configuration parameter to the TestKit. It&rsquo;s loaded with:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/TestConfigExample.scala#L21-L23" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import com.typesafe.config.ConfigFactory

ConfigFactory.load()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/TestConfigExample.java#L17-L26" target="_blank" title="Go to snippet source">source</a><code class="language-java">import com.typesafe.config.ConfigFactory;

ConfigFactory.load()</code></pre></dd>
</dl>
<p>It&rsquo;s often convenient to define configuration for a specific test as a <code>String</code> in the test itself and use that as the configuration parameter to the TestKit. <code>ConfigFactory.parseString</code> can be used for that:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/TestConfigExample.scala#L27-L30" target="_blank" title="Go to snippet source">source</a><code class="language-scala">ConfigFactory.parseString(&quot;&quot;&quot;
  pekko.loglevel = DEBUG
  pekko.log-config-on-start = on
  &quot;&quot;&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/TestConfigExample.java#L31" target="_blank" title="Go to snippet source">source</a><code class="language-java">ConfigFactory.parseString(&quot;pekko.loglevel = DEBUG \n&quot; + &quot;pekko.log-config-on-start = on \n&quot;)</code></pre></dd>
</dl>
<p>Combining those approaches using <code>withFallback</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/TestConfigExample.scala#L34-L37" target="_blank" title="Go to snippet source">source</a><code class="language-scala">ConfigFactory.parseString(&quot;&quot;&quot;
  pekko.loglevel = DEBUG
  pekko.log-config-on-start = on
  &quot;&quot;&quot;).withFallback(ConfigFactory.load())</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/TestConfigExample.java#L36-L37" target="_blank" title="Go to snippet source">source</a><code class="language-java">ConfigFactory.parseString(&quot;pekko.loglevel = DEBUG \n&quot; + &quot;pekko.log-config-on-start = on \n&quot;)
    .withFallback(ConfigFactory.load())</code></pre></dd>
</dl>
<p>More information can be found in the <a href="https://github.com/lightbend/config#using-the-library">documentation of the configuration library</a>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Note that <code>reference.conf</code> files are intended for libraries to define default values and shouldn&rsquo;t be used in an application. It&rsquo;s not supported to override a config property owned by one library in a <code>reference.conf</code> of another library.</p></div>
<h3><a href="#controlling-the-scheduler" name="controlling-the-scheduler" class="anchor"><span class="anchor-link"></span></a>Controlling the scheduler</h3>
<p>It can be hard to reliably unit test specific scenario&rsquo;s when your actor relies on timing: especially when running many tests in parallel it can be hard to get the timing just right. Making such tests more reliable by using generous timeouts make the tests take a long time to run.</p>
<p>For such situations, we provide a scheduler where you can manually, explicitly advance the clock.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/ManualTimerExampleSpec.scala#L17-L128" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import scala.concurrent.duration._
import org.apache.pekko
import pekko.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import pekko.actor.testkit.typed.scaladsl.ManualTime
import pekko.actor.testkit.typed.scaladsl.TestProbe
import pekko.actor.testkit.typed.scaladsl.LogCapturing
import pekko.actor.typed.scaladsl.Behaviors
import org.scalatest.wordspec.AnyWordSpecLike

class ManualTimerExampleSpec
    extends ScalaTestWithActorTestKit(ManualTime.config)
    with AnyWordSpecLike
    with LogCapturing {

  val manualTime: ManualTime = ManualTime()

  &quot;A timer&quot; must {
    &quot;schedule non-repeated ticks&quot; in {
      case object Tick
      case object Tock

      val probe = TestProbe[Tock.type]()
      val behavior = Behaviors.withTimers[Tick.type] { timer =&gt;
        timer.startSingleTimer(Tick, 10.millis)
        Behaviors.receiveMessage { _ =&gt;
          probe.ref ! Tock
          Behaviors.same
        }
      }

      spawn(behavior)

      manualTime.expectNoMessageFor(9.millis, probe)

      manualTime.timePasses(2.millis)
      probe.expectMessage(Tock)

      manualTime.expectNoMessageFor(10.seconds, probe)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/ManualTimerExampleTest.java#L17-L73" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>import org.apache.pekko.actor.testkit.typed.javadsl.LogCapturing;
import org.apache.pekko.actor.typed.Behavior;
import org.apache.pekko.actor.testkit.typed.javadsl.ManualTime;
import org.apache.pekko.actor.testkit.typed.javadsl.TestKitJunitResource;
import org.junit.ClassRule;
import org.junit.Rule;
import org.scalatestplus.junit.JUnitSuite;
import java.time.Duration;

import org.apache.pekko.actor.typed.javadsl.Behaviors;

import org.junit.Test;

import org.apache.pekko.actor.testkit.typed.javadsl.TestProbe;

public class ManualTimerExampleTest extends JUnitSuite {

  @ClassRule
  public static final TestKitJunitResource testKit = new TestKitJunitResource(ManualTime.config());

  @Rule public final LogCapturing logCapturing = new LogCapturing();

  private final ManualTime manualTime = ManualTime.get(testKit.system());

  static final class Tick {
    private Tick() {}

    static final Tick INSTANCE = new Tick();
  }

  static final class Tock {}

  @Test
  public void testScheduleNonRepeatedTicks() {
    TestProbe&lt;Tock&gt; probe = testKit.createTestProbe();
    Behavior&lt;Tick&gt; behavior =
        Behaviors.withTimers(
            timer -&gt; {
              timer.startSingleTimer(Tick.INSTANCE, Duration.ofMillis(10));
              return Behaviors.receiveMessage(
                  tick -&gt; {
                    probe.ref().tell(new Tock());
                    return Behaviors.same();
                  });
            });

    testKit.spawn(behavior);

    manualTime.expectNoMessageFor(Duration.ofMillis(9), probe);

    manualTime.timePasses(Duration.ofMillis(2));
    probe.expectMessageClass(Tock.class);

    manualTime.expectNoMessageFor(Duration.ofSeconds(10), probe);
  }
}</code></pre></dd>
</dl>
<h3><a href="#test-of-logging" name="test-of-logging" class="anchor"><span class="anchor-link"></span></a>Test of logging</h3>
<p>To verify that certain <a href="logging.html">logging</a> events are emitted there is a utility called <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/javadsl/LoggingTestKit.html" title="org.apache.pekko.actor.testkit.typed.javadsl.LoggingTestKit"><code>LoggingTestKit</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/scaladsl/LoggingTestKit.html" title="org.apache.pekko.actor.testkit.typed.scaladsl.LoggingTestKit"><code>LoggingTestKit</code></a></span> . You define a criteria of the expected logging events and it will assert that the given number of occurrences of matching logging events are emitted within a block of code.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/javadsl/LoggingTestKit.html" title="org.apache.pekko.actor.testkit.typed.javadsl.LoggingTestKit"><code>LoggingTestKit</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/scaladsl/LoggingTestKit.html" title="org.apache.pekko.actor.testkit.typed.scaladsl.LoggingTestKit"><code>LoggingTestKit</code></a></span> implementation <a href="logging.html#logback">requires Logback dependency</a>.</p></div>
<p>For example, a criteria that verifies that an <code>INFO</code> level event with a message containing &ldquo;Received message&rdquo; is logged:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/LoggingDocExamples.scala#L126-L133" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko.actor.testkit.typed.scaladsl.LoggingTestKit

// implicit ActorSystem is needed, but that is given by ScalaTestWithActorTestKit
// implicit val system: ActorSystem[_]

LoggingTestKit.info(&quot;Received message&quot;).expect {
  ref ! Message(&quot;hello&quot;)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/LoggingDocExamples.java#L34-L176" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.testkit.typed.javadsl.LoggingTestKit;

LoggingTestKit.info(&quot;Received message&quot;)
    .expect(
        system,
        () -&gt; {
          ref.tell(new Message(&quot;hello&quot;));
          return null;
        });</code></pre></dd>
</dl>
<p>More advanced criteria can be built by chaining conditions that all must be satisfied for a matching event.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/LoggingDocExamples.scala#L137-L150" target="_blank" title="Go to snippet source">source</a><code class="language-scala">LoggingTestKit
  .error[IllegalArgumentException]
  .withMessageRegex(&quot;.*was rejected.*expecting ascii input.*&quot;)
  .withCustom { event =&gt;
    event.marker match {
      case Some(m) =&gt; m.getName == &quot;validation&quot;
      case None    =&gt; false
    }
  }
  .withOccurrences(2)
  .expect {
    ref ! Message(&quot;hellÃ¶&quot;)
    ref ! Message(&quot;hejdÃ¥&quot;)
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/LoggingDocExamples.java#L180-L193" target="_blank" title="Go to snippet source">source</a><code class="language-java">LoggingTestKit.error(IllegalArgumentException.class)
    .withMessageRegex(&quot;.*was rejected.*expecting ascii input.*&quot;)
    .withCustom(
        event -&gt;
            event.getMarker().isPresent()
                &amp;&amp; event.getMarker().get().getName().equals(&quot;validation&quot;))
    .withOccurrences(2)
    .expect(
        system,
        () -&gt; {
          ref.tell(new Message(&quot;hellÃ¶&quot;));
          ref.tell(new Message(&quot;hejdÃ¥&quot;));
          return null;
        });</code></pre></dd>
</dl>
<p>See <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/javadsl/LoggingTestKit.html" title="org.apache.pekko.actor.testkit.typed.javadsl.LoggingTestKit"><code>LoggingTestKit</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/testkit/typed/scaladsl/LoggingTestKit.html" title="org.apache.pekko.actor.testkit.typed.scaladsl.LoggingTestKit"><code>LoggingTestKit</code></a></span> for more details.</p>
<h3><a href="#silence-logging-output-from-tests" name="silence-logging-output-from-tests" class="anchor"><span class="anchor-link"></span></a>Silence logging output from tests</h3>
<p>When running tests, it&rsquo;s typically preferred to have the output to standard out, together with the output from the testing framework (<span class="group-scala">ScalaTest</span><span class="group-java">JUnit</span>). On one hand you want the output to be clean without logging noise, but on the other hand you want as much information as possible if there is a test failure (for example in CI builds).</p>
<p>The Pekko TestKit provides a <code>LogCapturing</code> utility to support this with ScalaTest or JUnit. It will buffer log events instead of emitting them to the <code>ConsoleAppender</code> immediately (or whatever Logback appender that is configured). When there is a test failure the buffered events are flushed to the target appenders, typically a <code>ConsoleAppender</code>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>LogCapturing</code> utility <a href="logging.html#logback">requires Logback dependency</a>.</p></div>
<p><span class="group-scala">Mix <code>LogCapturing</code> trait into the ScalaTest</span><span class="group-java">Add a <code>LogCapturing</code> <code>@Rule</code> in the JUnit test</span> like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/scala/docs/org/apache/pekko/actor/testkit/typed/scaladsl/ScalaTestIntegrationExampleSpec.scala#L20-L55" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.testkit.typed.scaladsl.LogCapturing
import pekko.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import org.scalatest.wordspec.AnyWordSpecLike

class LogCapturingExampleSpec extends ScalaTestWithActorTestKit with AnyWordSpecLike with LogCapturing {

  &quot;Something&quot; must {
    &quot;behave correctly&quot; in {
      val pinger = testKit.spawn(Echo(), &quot;ping&quot;)
      val probe = testKit.createTestProbe[Echo.Pong]()
      pinger ! Echo.Ping(&quot;hello&quot;, probe.ref)
      probe.expectMessage(Echo.Pong(&quot;hello&quot;))
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-testkit-typed/src/test/java/jdocs/org/apache/pekko/actor/testkit/typed/javadsl/LogCapturingExampleTest.java#L19-L40" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.testkit.typed.javadsl.LogCapturing;
import org.apache.pekko.actor.testkit.typed.javadsl.TestKitJunitResource;
import org.apache.pekko.actor.testkit.typed.javadsl.TestProbe;
import org.apache.pekko.actor.typed.ActorRef;
import org.junit.ClassRule;
import org.junit.Rule;
import org.junit.Test;

public class LogCapturingExampleTest {

  @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource();

  @Rule public final LogCapturing logCapturing = new LogCapturing();

  @Test
  public void testSomething() {
    ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create(), &quot;ping&quot;);
    TestProbe&lt;Echo.Pong&gt; probe = testKit.createTestProbe();
    pinger.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
    probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
  }
}</code></pre></dd>
</dl>
<p>Then you also need to configure the <code>CapturingAppender</code> and <code>CapturingAppenderDelegate</code> in <code>src/test/resources/logback-test.xml</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/resources/logback-doc-test.xml" target="_blank" title="Go to snippet source">source</a><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;

    &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
        &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;
            &lt;level&gt;INFO&lt;/level&gt;
        &lt;/filter&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;[%date{ISO8601}] [%level] [%logger] [%marker] [%thread] - %msg MDC: {%mdc}%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;!--
    Logging from tests are silenced by this appender. When there is a test failure
    the captured logging events are flushed to the appenders defined for the
    org.apache.pekko.actor.testkit.typed.internal.CapturingAppenderDelegate logger.
    --&gt;
    &lt;appender name=&quot;CapturingAppender&quot; class=&quot;org.apache.pekko.actor.testkit.typed.internal.CapturingAppender&quot; /&gt;

    &lt;!--
    The appenders defined for this CapturingAppenderDelegate logger are used
    when there is a test failure and all logging events from the test are
    flushed to these appenders.
    --&gt;
    &lt;logger name=&quot;org.apache.pekko.actor.testkit.typed.internal.CapturingAppenderDelegate&quot; &gt;
      &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
    &lt;/logger&gt;

    &lt;root level=&quot;DEBUG&quot;&gt;
        &lt;appender-ref ref=&quot;CapturingAppender&quot;/&gt;
    &lt;/root&gt;
&lt;/configuration&gt;</code></pre>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/typed/testing-async.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../typed/testing.html" title="Testing" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Testing
</span>
</div>
</a>
<a href="../typed/testing-sync.html" title="Synchronous behavior testing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Synchronous behavior testing
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright Â© 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../assets/js/groups.js"></script>
</body>
</html>
