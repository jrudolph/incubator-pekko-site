<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Mailboxes Â· Apache Pekko</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Mailboxes
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../downloads.html" class="page">Downloads</a></li>
  <li><a href="../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../typed/index.html" class="page">Actors</a></li>
    <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../stream/index.html" class="page">Streams</a></li>
    <li><a href="../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../project/index.html" class="page">Project Information</a></li>
    <li><a href="../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/mailboxes.html#mailboxes" class="header">Mailboxes</a>
  <ul>
    <li><a href="../typed/mailboxes.html#dependency" class="header">Dependency</a></li>
    <li><a href="../typed/mailboxes.html#introduction" class="header">Introduction</a></li>
    <li><a href="../typed/mailboxes.html#selecting-what-mailbox-is-used" class="header">Selecting what mailbox is used</a></li>
    <li><a href="../typed/mailboxes.html#mailbox-implementations" class="header">Mailbox Implementations</a></li>
    <li><a href="../typed/mailboxes.html#custom-mailbox-type" class="header">Custom Mailbox type</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/mailboxes.html#mailboxes" class="header">Mailboxes</a>
  <ul>
    <li><a href="../typed/mailboxes.html#dependency" class="header">Dependency</a></li>
    <li><a href="../typed/mailboxes.html#introduction" class="header">Introduction</a></li>
    <li><a href="../typed/mailboxes.html#selecting-what-mailbox-is-used" class="header">Selecting what mailbox is used</a></li>
    <li><a href="../typed/mailboxes.html#mailbox-implementations" class="header">Mailbox Implementations</a></li>
    <li><a href="../typed/mailboxes.html#custom-mailbox-type" class="header">Custom Mailbox type</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#mailboxes" name="mailboxes" class="anchor"><span class="anchor-link"></span></a>Mailboxes</h1>
<p>You are viewing the documentation for the new actor APIs, to view the Pekko Classic documentation, see <a href="../mailboxes.html">Classic Mailboxes</a>.</p>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>Mailboxes are part of core Pekko, which means that they are part of the <code>pekko-actor</code> dependency. This page describes how to use mailboxes with <code>pekko-actor-typed</code>, which has dependency:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val PekkoVersion = "2.6.20+81-523134c3+20230202-1514-SNAPSHOT"
libraryDependencies += "org.apache.pekko" %% "pekko-actor-typed" % PekkoVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
      &lt;artifactId&gt;pekko-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.6.20+81-523134c3+20230202-1514-SNAPSHOT&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
    &lt;artifactId&gt;pekko-actor-typed_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("org.apache.pekko:pekko-bom_${versions.ScalaBinary}:2.6.20+81-523134c3+20230202-1514-SNAPSHOT")

  implementation "org.apache.pekko:pekko-actor-typed_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>Each actor in Pekko has a <code>Mailbox</code>, this is where the messages are enqueued before being processed by the actor.</p>
<p>By default an unbounded mailbox is used, this means any number of messages can be enqueued into the mailbox. </p>
<p>The unbounded mailbox is a convenient default but in a scenario where messages are added to the mailbox faster than the actor can process them, this can lead to the application running out of memory. For this reason a bounded mailbox can be specified, the bounded mailbox will pass new messages to <code>deadletters</code> when the mailbox is full.</p>
<p>For advanced use cases it is also possible to defer mailbox selection to config by pointing to a config path.</p>
<h2><a href="#selecting-what-mailbox-is-used" name="selecting-what-mailbox-is-used" class="anchor"><span class="anchor-link"></span></a>Selecting what mailbox is used</h2>
<h3><a href="#selecting-a-mailbox-type-for-an-actor" name="selecting-a-mailbox-type-for-an-actor" class="anchor"><span class="anchor-link"></span></a>Selecting a Mailbox Type for an Actor</h3>
<p>To select a specific mailbox for an actor use <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/MailboxSelector$.html" title="org.apache.pekko.actor.typed.MailboxSelector"><code>MailboxSelector</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/MailboxSelector$.html" title="org.apache.pekko.actor.typed.MailboxSelector"><code>MailboxSelector</code></a></span> to create a <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Props.html" title="org.apache.pekko.actor.typed.Props"><code>Props</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Props.html" title="org.apache.pekko.actor.typed.Props"><code>Props</code></a></span> instance for spawning your actor:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/scala/docs/org/apache/pekko/typed/MailboxDocSpec.scala#L37-L40" target="_blank" title="Go to snippet source">source</a><code class="language-scala">context.spawn(childBehavior, &quot;bounded-mailbox-child&quot;, MailboxSelector.bounded(100))

val props = MailboxSelector.fromConfig(&quot;my-app.my-special-mailbox&quot;)
context.spawn(childBehavior, &quot;from-config-mailbox-child&quot;, props)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/java/jdocs/org/apache/pekko/typed/MailboxDocTest.java#L47-L52" target="_blank" title="Go to snippet source">source</a><code class="language-java">context.spawn(childBehavior, &quot;bounded-mailbox-child&quot;, MailboxSelector.bounded(100));

context.spawn(
    childBehavior,
    &quot;from-config-mailbox-child&quot;,
    MailboxSelector.fromConfig(&quot;my-app.my-special-mailbox&quot;));</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/MailboxSelector$.html#fromConfig(path:String):org.apache.pekko.actor.typed.MailboxSelector" title="org.apache.pekko.actor.typed.MailboxSelector"><code>fromConfig</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/MailboxSelector$.html#fromConfig(java.lang.String)" title="org.apache.pekko.actor.typed.MailboxSelector"><code>fromConfig</code></a></span> takes an absolute config path to a block defining the dispatcher in the config file:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/actor-typed-tests/src/test/resources/mailbox-config-sample.conf" target="_blank" title="Go to snippet source">source</a><code class="language-conf">my-app {
  my-special-mailbox {
    mailbox-type = &quot;org.apache.pekko.dispatch.SingleConsumerOnlyUnboundedMailbox&quot;
  }
}</code></pre>
<h3><a href="#default-mailbox" name="default-mailbox" class="anchor"><span class="anchor-link"></span></a>Default Mailbox</h3>
<p>The default mailbox is used when the mailbox is not specified and is the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/SingleConsumerOnlyUnboundedMailbox.html" title="org.apache.pekko.dispatch.SingleConsumerOnlyUnboundedMailbox"><code>SingleConsumerOnlyUnboundedMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/SingleConsumerOnlyUnboundedMailbox.html" title="org.apache.pekko.dispatch.SingleConsumerOnlyUnboundedMailbox"><code>SingleConsumerOnlyUnboundedMailbox</code></a></span></p>
<h3><a href="#which-configuration-is-passed-to-the-mailbox-type" name="which-configuration-is-passed-to-the-mailbox-type" class="anchor"><span class="anchor-link"></span></a>Which Configuration is passed to the Mailbox Type</h3>
<p>Each mailbox type is implemented by a class which extends <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/MailboxType.html" title="org.apache.pekko.dispatch.MailboxType"><code>MailboxType</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/MailboxType.html" title="org.apache.pekko.dispatch.MailboxType"><code>MailboxType</code></a></span> and takes two constructor arguments: a <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Settings.html" title="org.apache.pekko.actor.typed.Settings"><code>ActorSystem.Settings</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/Settings.html" title="org.apache.pekko.actor.typed.Settings"><code>ActorSystem.Settings</code></a></span> object and a <a href="https://lightbend.github.io/config/latest/api/index.html?com/typesafe/config/Config.html">Config</a> section. The latter is computed by obtaining the named configuration section from the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> configuration, overriding its <code>id</code> key with the configuration path of the mailbox type and adding a fall-back to the default mailbox configuration section.</p>
<h2><a href="#mailbox-implementations" name="mailbox-implementations" class="anchor"><span class="anchor-link"></span></a>Mailbox Implementations</h2>
<p>Pekko ships with a number of mailbox implementations:</p>
<ul>
  <li> <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/SingleConsumerOnlyUnboundedMailbox.html" title="org.apache.pekko.dispatch.SingleConsumerOnlyUnboundedMailbox"><code>SingleConsumerOnlyUnboundedMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/SingleConsumerOnlyUnboundedMailbox.html" title="org.apache.pekko.dispatch.SingleConsumerOnlyUnboundedMailbox"><code>SingleConsumerOnlyUnboundedMailbox</code></a></span> (default)
    <ul>
      <li>This is the default</li>
      <li>Backed by a Multiple-Producer Single-Consumer queue, cannot be used with <code>BalancingDispatcher</code></li>
      <li>Blocking: No</li>
      <li>Bounded: No</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.SingleConsumerOnlyUnboundedMailbox&quot;</code></li>
    </ul>
  </li>
  <li> <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedMailbox.html" title="org.apache.pekko.dispatch.UnboundedMailbox"><code>UnboundedMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedMailbox.html" title="org.apache.pekko.dispatch.UnboundedMailbox"><code>UnboundedMailbox</code></a></span>
    <ul>
      <li>Backed by a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ConcurrentLinkedQueue.html" title="java.util.concurrent.ConcurrentLinkedQueue"><code>java.util.concurrent.ConcurrentLinkedQueue</code></a></li>
      <li>Blocking: No</li>
      <li>Bounded: No</li>
      <li>Configuration name: <code>&quot;unbounded&quot;</code> or <code>&quot;org.apache.pekko.dispatch.UnboundedMailbox&quot;</code></li>
    </ul>
  </li>
  <li>
    <p><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/NonBlockingBoundedMailbox.html" title="org.apache.pekko.dispatch.NonBlockingBoundedMailbox"><code>NonBlockingBoundedMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/NonBlockingBoundedMailbox.html" title="org.apache.pekko.dispatch.NonBlockingBoundedMailbox"><code>NonBlockingBoundedMailbox</code></a></span></p>
    <ul>
      <li>Backed by a very efficient Multiple-Producer Single-Consumer queue</li>
      <li>Blocking: No (discards overflowing messages into deadLetters)</li>
      <li>Bounded: Yes</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.NonBlockingBoundedMailbox&quot;</code></li>
    </ul>
  </li>
  <li> <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedControlAwareMailbox.html" title="org.apache.pekko.dispatch.UnboundedControlAwareMailbox"><code>UnboundedControlAwareMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedControlAwareMailbox.html" title="org.apache.pekko.dispatch.UnboundedControlAwareMailbox"><code>UnboundedControlAwareMailbox</code></a></span>
    <ul>
      <li>Delivers messages that extend <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/ControlMessage.html" title="org.apache.pekko.dispatch.ControlMessage"><code>dispatch.ControlMessage</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/ControlMessage.html" title="org.apache.pekko.dispatch.ControlMessage"><code>dispatch.ControlMessage</code></a></span> with higher priority</li>
      <li>Backed by two <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ConcurrentLinkedQueue.html" title="java.util.concurrent.ConcurrentLinkedQueue"><code>java.util.concurrent.ConcurrentLinkedQueue</code></a></li>
      <li>Blocking: No</li>
      <li>Bounded: No</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.UnboundedControlAwareMailbox&quot;</code></li>
    </ul>
  </li>
  <li> <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedPriorityMailbox.html" title="org.apache.pekko.dispatch.UnboundedPriorityMailbox"><code>UnboundedPriorityMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedPriorityMailbox.html" title="org.apache.pekko.dispatch.UnboundedPriorityMailbox"><code>UnboundedPriorityMailbox</code></a></span>
    <ul>
      <li>Backed by a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/PriorityBlockingQueue.html" title="java.util.concurrent.PriorityBlockingQueue"><code>java.util.concurrent.PriorityBlockingQueue</code></a></li>
      <li>Delivery order for messages of equal priority is undefined - contrast with the <code>UnboundedStablePriorityMailbox</code></li>
      <li>Blocking: No</li>
      <li>Bounded: No</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.UnboundedPriorityMailbox&quot;</code></li>
    </ul>
  </li>
  <li> <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedStablePriorityMailbox.html" title="org.apache.pekko.dispatch.UnboundedStablePriorityMailbox"><code>UnboundedStablePriorityMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/UnboundedStablePriorityMailbox.html" title="org.apache.pekko.dispatch.UnboundedStablePriorityMailbox"><code>UnboundedStablePriorityMailbox</code></a></span>
    <ul>
      <li>Backed by a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/PriorityBlockingQueue.html" title="java.util.concurrent.PriorityBlockingQueue"><code>java.util.concurrent.PriorityBlockingQueue</code></a> wrapped in an <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/PriorityQueueStabilizer.html" title="org.apache.pekko.util.PriorityQueueStabilizer"><code>util.PriorityQueueStabilizer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/PriorityQueueStabilizer.html" title="org.apache.pekko.util.PriorityQueueStabilizer"><code>util.PriorityQueueStabilizer</code></a></span></li>
      <li>FIFO order is preserved for messages of equal priority - contrast with the <code>UnboundedPriorityMailbox</code></li>
      <li>Blocking: No</li>
      <li>Bounded: No</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.UnboundedStablePriorityMailbox&quot;</code></li>
    </ul>
  </li>
</ul>
<p>Other bounded mailbox implementations which will block the sender if the capacity is reached and configured with non-zero <code>mailbox-push-timeout-time</code>. </p><div class="callout note "><div class="callout-title">Note</div>
<p>The following mailboxes should only be used with zero <code>mailbox-push-timeout-time</code>.</p></div>
<ul>
  <li><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedMailbox.html" title="org.apache.pekko.dispatch.BoundedMailbox"><code>BoundedMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedMailbox.html" title="org.apache.pekko.dispatch.BoundedMailbox"><code>BoundedMailbox</code></a></span>
    <ul>
      <li>Backed by a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/LinkedBlockingQueue.html" title="java.util.concurrent.LinkedBlockingQueue"><code>java.util.concurrent.LinkedBlockingQueue</code></a></li>
      <li>Blocking: Yes if used with non-zero <code>mailbox-push-timeout-time</code>, otherwise No</li>
      <li>Bounded: Yes</li>
      <li>Configuration name: <code>&quot;bounded&quot;</code> or <code>&quot;org.apache.pekko.dispatch.BoundedMailbox&quot;</code></li>
    </ul>
  </li>
  <li><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedPriorityMailbox.html" title="org.apache.pekko.dispatch.BoundedPriorityMailbox"><code>BoundedPriorityMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedPriorityMailbox.html" title="org.apache.pekko.dispatch.BoundedPriorityMailbox"><code>BoundedPriorityMailbox</code></a></span>
    <ul>
      <li>Backed by a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/PriorityQueue.html" title="java.util.PriorityQueue"><code>java.util.PriorityQueue</code></a> wrapped in an <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/BoundedBlockingQueue.html" title="org.apache.pekko.util.BoundedBlockingQueue"><code>util.BoundedBlockingQueue</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/BoundedBlockingQueue.html" title="org.apache.pekko.util.BoundedBlockingQueue"><code>util.BoundedBlockingQueue</code></a></span></li>
      <li>Delivery order for messages of equal priority is undefined - contrast with the <code>BoundedStablePriorityMailbox</code></li>
      <li>Blocking: Yes if used with non-zero <code>mailbox-push-timeout-time</code>, otherwise No</li>
      <li>Bounded: Yes</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.BoundedPriorityMailbox&quot;</code></li>
    </ul>
  </li>
  <li><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedStablePriorityMailbox.html" title="org.apache.pekko.dispatch.BoundedStablePriorityMailbox"><code>BoundedStablePriorityMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedStablePriorityMailbox.html" title="org.apache.pekko.dispatch.BoundedStablePriorityMailbox"><code>BoundedStablePriorityMailbox</code></a></span>
    <ul>
      <li>Backed by a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/PriorityQueue.html" title="java.util.PriorityQueue"><code>java.util.PriorityQueue</code></a> wrapped in an <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/PriorityQueueStabilizer.html" title="org.apache.pekko.util.PriorityQueueStabilizer"><code>util.PriorityQueueStabilizer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/PriorityQueueStabilizer.html" title="org.apache.pekko.util.PriorityQueueStabilizer"><code>util.PriorityQueueStabilizer</code></a></span> and an <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/BoundedBlockingQueue.html" title="org.apache.pekko.util.BoundedBlockingQueue"><code>util.BoundedBlockingQueue</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/util/BoundedBlockingQueue.html" title="org.apache.pekko.util.BoundedBlockingQueue"><code>util.BoundedBlockingQueue</code></a></span></li>
      <li>FIFO order is preserved for messages of equal priority - contrast with the BoundedPriorityMailbox</li>
      <li>Blocking: Yes if used with non-zero <code>mailbox-push-timeout-time</code>, otherwise No</li>
      <li>Bounded: Yes</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.BoundedStablePriorityMailbox&quot;</code></li>
    </ul>
  </li>
  <li><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedControlAwareMailbox.html" title="org.apache.pekko.dispatch.BoundedControlAwareMailbox"><code>BoundedControlAwareMailbox</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/BoundedControlAwareMailbox.html" title="org.apache.pekko.dispatch.BoundedControlAwareMailbox"><code>BoundedControlAwareMailbox</code></a></span>
    <ul>
      <li>Delivers messages that extend <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/ControlMessage.html" title="org.apache.pekko.dispatch.ControlMessage"><code>dispatch.ControlMessage</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/dispatch/ControlMessage.html" title="org.apache.pekko.dispatch.ControlMessage"><code>dispatch.ControlMessage</code></a></span> with higher priority</li>
      <li>Backed by two <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ConcurrentLinkedQueue.html" title="java.util.concurrent.ConcurrentLinkedQueue"><code>java.util.concurrent.ConcurrentLinkedQueue</code></a> and blocking on enqueue if capacity has been reached</li>
      <li>Blocking: Yes if used with non-zero <code>mailbox-push-timeout-time</code>, otherwise No</li>
      <li>Bounded: Yes</li>
      <li>Configuration name: <code>&quot;org.apache.pekko.dispatch.BoundedControlAwareMailbox&quot;</code></li>
    </ul>
  </li>
</ul>
<h2><a href="#custom-mailbox-type" name="custom-mailbox-type" class="anchor"><span class="anchor-link"></span></a>Custom Mailbox type</h2>
<p>The best way to show how to create your own Mailbox type is by example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/dispatcher/MyUnboundedMailbox.scala#L66-L67" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// Marker trait used for mailbox requirements mapping
trait MyUnboundedMessageQueueSemantics</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/dispatcher/MyUnboundedMessageQueueSemantics.java#L17-L18" target="_blank" title="Go to snippet source">source</a><code class="language-java">// Marker interface used for mailbox requirements mapping
public interface MyUnboundedMessageQueueSemantics {}</code></pre></dd>
</dl>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/dispatcher/MyUnboundedMailbox.scala#L17-L62" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.ActorRef
import pekko.actor.ActorSystem
import pekko.dispatch.Envelope
import pekko.dispatch.MailboxType
import pekko.dispatch.MessageQueue
import pekko.dispatch.ProducesMessageQueue
import com.typesafe.config.Config
import java.util.concurrent.ConcurrentLinkedQueue
import scala.Option

object MyUnboundedMailbox {
  // This is the MessageQueue implementation
  class MyMessageQueue extends MessageQueue with MyUnboundedMessageQueueSemantics {

    private final val queue = new ConcurrentLinkedQueue[Envelope]()

    // these should be implemented; queue used as example
    def enqueue(receiver: ActorRef, handle: Envelope): Unit =
      queue.offer(handle)
    def dequeue(): Envelope = queue.poll()
    def numberOfMessages: Int = queue.size
    def hasMessages: Boolean = !queue.isEmpty
    def cleanUp(owner: ActorRef, deadLetters: MessageQueue): Unit = {
      while (hasMessages) {
        deadLetters.enqueue(owner, dequeue())
      }
    }
  }
}

// This is the Mailbox implementation
class MyUnboundedMailbox extends MailboxType with ProducesMessageQueue[MyUnboundedMailbox.MyMessageQueue] {

  import MyUnboundedMailbox._

  // This constructor signature must exist, it will be called by Pekko
  def this(settings: ActorSystem.Settings, config: Config) = {
    // put your initialization code here
    this()
  }

  // The create method is called to create the MessageQueue
  final override def create(owner: Option[ActorRef], system: Option[ActorSystem]): MessageQueue =
    new MyMessageQueue()
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/dispatcher/MyUnboundedMailbox.java#L17-L68" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.ActorRef;
import org.apache.pekko.actor.ActorSystem;
import org.apache.pekko.dispatch.Envelope;
import org.apache.pekko.dispatch.MailboxType;
import org.apache.pekko.dispatch.MessageQueue;
import org.apache.pekko.dispatch.ProducesMessageQueue;
import com.typesafe.config.Config;
import java.util.concurrent.ConcurrentLinkedQueue;
import java.util.Queue;
import scala.Option;

public class MyUnboundedMailbox
    implements MailboxType, ProducesMessageQueue&lt;MyUnboundedMailbox.MyMessageQueue&gt; {

  // This is the MessageQueue implementation
  public static class MyMessageQueue implements MessageQueue, MyUnboundedMessageQueueSemantics {
    private final Queue&lt;Envelope&gt; queue = new ConcurrentLinkedQueue&lt;Envelope&gt;();

    // these must be implemented; queue used as example
    public void enqueue(ActorRef receiver, Envelope handle) {
      queue.offer(handle);
    }

    public Envelope dequeue() {
      return queue.poll();
    }

    public int numberOfMessages() {
      return queue.size();
    }

    public boolean hasMessages() {
      return !queue.isEmpty();
    }

    public void cleanUp(ActorRef owner, MessageQueue deadLetters) {
      while (!queue.isEmpty()) {
        deadLetters.enqueue(owner, dequeue());
      }
    }
  }

  // This constructor signature must exist, it will be called by Pekko
  public MyUnboundedMailbox(ActorSystem.Settings settings, Config config) {
    // put your initialization code here
  }

  // The create method is called to create the MessageQueue
  public MessageQueue create(Option&lt;ActorRef&gt; owner, Option&lt;ActorSystem&gt; system) {
    return new MyMessageQueue();
  }
}</code></pre></dd>
</dl>
<p>And then you specify the FQCN of your MailboxType as the value of the &ldquo;mailbox-type&rdquo; in the dispatcher configuration, or the mailbox configuration.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Make sure to include a constructor which takes <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorSystem$$Settings.html" title="org.apache.pekko.actor.ActorSystem.Settings"><code>actor.ActorSystem.Settings</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/ActorSystem$$Settings.html" title="org.apache.pekko.actor.ActorSystem.Settings"><code>actor.ActorSystem.Settings</code></a></span> and <a href="https://lightbend.github.io/config/latest/api/index.html?com/typesafe/config/Config.html">com.typesafe.config.Config</a> arguments, as this constructor is invoked reflectively to construct your mailbox type. The config passed in as second argument is that section from the configuration which describes the dispatcher or mailbox setting using this mailbox type; the mailbox type will be instantiated once for each dispatcher or mailbox setting using it.</p></div>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/typed/mailboxes.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../typed/dispatchers.html" title="Dispatchers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Dispatchers
</span>
</div>
</a>
<a href="../typed/testing.html" title="Testing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Testing
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright Â© 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../assets/js/groups.js"></script>
</body>
</html>
