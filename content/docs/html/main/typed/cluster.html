<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Build distributed applications that scale across the network with Apache Pekko Cluster, a fault-tolerant decentralized peer-to-peer based cluster node membership service with no single point of failure.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Build distributed applications that scale across the network with Apache Pekko Cluster, a fault-tolerant decentralized peer-to-peer based cluster node membership service with no single point of failure.">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Cluster Usage · Apache Pekko</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Cluster Usage
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../downloads.html" class="page">Downloads</a></li>
  <li><a href="../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../typed/index.html" class="page">Actors</a></li>
    <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../stream/index.html" class="page">Streams</a></li>
    <li><a href="../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../project/index.html" class="page">Project Information</a></li>
    <li><a href="../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/cluster.html#cluster-usage" class="header">Cluster Usage</a>
  <ul>
    <li><a href="../typed/cluster.html#module-info" class="header">Module info</a></li>
    <li><a href="../typed/cluster.html#cluster-api-extension" class="header">Cluster API Extension</a></li>
    <li><a href="../typed/cluster.html#cluster-membership-api" class="header">Cluster Membership API</a></li>
    <li><a href="../typed/cluster.html#node-roles" class="header">Node Roles</a></li>
    <li><a href="../typed/cluster.html#failure-detector" class="header">Failure Detector</a></li>
    <li><a href="../typed/cluster.html#how-to-test" class="header">How to test</a></li>
    <li><a href="../typed/cluster.html#configuration" class="header">Configuration</a></li>
    <li><a href="../typed/cluster.html#higher-level-cluster-tools" class="header">Higher level Cluster tools</a></li>
    <li><a href="../typed/cluster.html#example-project" class="header">Example project</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../typed/cluster.html#cluster-usage" class="header">Cluster Usage</a>
  <ul>
    <li><a href="../typed/cluster.html#module-info" class="header">Module info</a></li>
    <li><a href="../typed/cluster.html#cluster-api-extension" class="header">Cluster API Extension</a></li>
    <li><a href="../typed/cluster.html#cluster-membership-api" class="header">Cluster Membership API</a></li>
    <li><a href="../typed/cluster.html#node-roles" class="header">Node Roles</a></li>
    <li><a href="../typed/cluster.html#failure-detector" class="header">Failure Detector</a></li>
    <li><a href="../typed/cluster.html#how-to-test" class="header">How to test</a></li>
    <li><a href="../typed/cluster.html#configuration" class="header">Configuration</a></li>
    <li><a href="../typed/cluster.html#higher-level-cluster-tools" class="header">Higher level Cluster tools</a></li>
    <li><a href="../typed/cluster.html#example-project" class="header">Example project</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#cluster-usage" name="cluster-usage" class="anchor"><span class="anchor-link"></span></a>Cluster Usage</h1>
<p>This document describes how to use Apache Pekko Cluster and the Cluster APIs. </p>
<p>For specific documentation topics see: </p>
<ul>
  <li><a href="choosing-cluster.html">When and where to use Pekko Cluster</a></li>
  <li><a href="cluster-concepts.html">Cluster Specification</a></li>
  <li><a href="cluster-membership.html">Cluster Membership Service</a></li>
  <li><a href="cluster.html#higher-level-cluster-tools">Higher level Cluster tools</a></li>
  <li><a href="../additional/rolling-updates.html">Rolling Updates</a></li>
  <li><a href="../additional/operations.html">Operating, Managing, Observability</a></li>
</ul>
<p>You are viewing the documentation for the new actor APIs, to view the Pekko Classic documentation, see <a href="../cluster-usage.html">Classic Cluster</a>.</p>
<p>You have to enable <a href="../serialization.html">serialization</a> to send messages between ActorSystems (nodes) in the Cluster. <a href="../serialization-jackson.html">Serialization with Jackson</a> is a good choice in many cases, and our recommendation if you don&rsquo;t have other preferences or constraints.</p>
<h2><a href="#module-info" name="module-info" class="anchor"><span class="anchor-link"></span></a>Module info</h2>
<p>To use Pekko Cluster add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val PekkoVersion = "2.6.20+81-523134c3+20230202-1514-SNAPSHOT"
libraryDependencies += "org.apache.pekko" %% "pekko-cluster-typed" % PekkoVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
      &lt;artifactId&gt;pekko-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.6.20+81-523134c3+20230202-1514-SNAPSHOT&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.pekko&lt;/groupId&gt;
    &lt;artifactId&gt;pekko-cluster-typed_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("org.apache.pekko:pekko-bom_${versions.ScalaBinary}:2.6.20+81-523134c3+20230202-1514-SNAPSHOT")

  implementation "org.apache.pekko:pekko-cluster-typed_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<table class="project-info">
<tr><th colspan="2">Project Info: Pekko Cluster (typed)</th></tr>
  <tr><th>Artifact</th><td><div>org.apache.pekko</div>
  <div>pekko-cluster-typed</div>
  <div>2.6.20+81-523134c3+20230202-1514-SNAPSHOT</div>
  <div><a href="project/links.html#snapshots-repository">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8</div><div>Adopt OpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.8, 2.12.16, 3.1.2</td></tr>
  <tr><th>JPMS module name</th><td>pekko.cluster.typed</td></tr>
  <tr><th>License</th><td><div><a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  
  <tr><th>Home page</th><td><a href="https://pekko.apache.org/">https://pekko.apache.org/</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://pekko.apache.org/api/pekko/snapshot/pekko/cluster/typed/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  <div><a href="https://pekko.apache.org/japi/pekko/snapshot/pekko/cluster/typed/package-summary.html" target="_blank" rel="noopener noreferrer">API (Javadoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://lists.apache.org/list.html?dev@pekko.apache.org" target="_blank" rel="noopener noreferrer">Apache Pekko Dev mailing list</a></div>
  <div><a href="https://github.com/apache/incubator-pekko/discussions" target="_blank" rel="noopener noreferrer">apache/incubator-pekko discussion</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://akka.io/blog/news-archive.html">akka.io blog</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/apache/incubator-pekko/issues" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/apache/incubator-pekko" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-pekko</a></td></tr>
</table>

<h2><a href="#cluster-api-extension" name="cluster-api-extension" class="anchor"><span class="anchor-link"></span></a>Cluster API Extension</h2>

<p>The Cluster extension gives you access to management tasks such as <a href="cluster-membership.html#user-actions">Joining, Leaving and Downing</a> and subscription of cluster membership events such as <a href="cluster-membership.html#membership-lifecycle">MemberUp, MemberRemoved and UnreachableMember</a>, which are exposed as event APIs. </p>

<p>It does this through these references on the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Cluster$.html" title="org.apache.pekko.cluster.typed.Cluster"><code>Cluster</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Cluster$.html" title="org.apache.pekko.cluster.typed.Cluster"><code>Cluster</code></a></span> extension:</p>

<ul>
  <li><code>manager</code>: An <span class="group-scala"><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span>[<span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterCommand.html" title="org.apache.pekko.cluster.typed.ClusterCommand"><code>cluster.typed.ClusterCommand</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterCommand.html" title="org.apache.pekko.cluster.typed.ClusterCommand"><code>cluster.typed.ClusterCommand</code></a></span>]</span><span class="group-java"><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span>&lt;<span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterCommand.html" title="org.apache.pekko.cluster.typed.ClusterCommand"><code>cluster.typed.ClusterCommand</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterCommand.html" title="org.apache.pekko.cluster.typed.ClusterCommand"><code>cluster.typed.ClusterCommand</code></a></span>&gt;</span> where a <code>ClusterCommand</code> is a command such as: <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Join.html" title="org.apache.pekko.cluster.typed.Join"><code>Join</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Join.html" title="org.apache.pekko.cluster.typed.Join"><code>Join</code></a></span>, <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Leave.html" title="org.apache.pekko.cluster.typed.Leave"><code>Leave</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Leave.html" title="org.apache.pekko.cluster.typed.Leave"><code>Leave</code></a></span> and <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Down.html" title="org.apache.pekko.cluster.typed.Down"><code>Down</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Down.html" title="org.apache.pekko.cluster.typed.Down"><code>Down</code></a></span></li>
  <li><code>subscriptions</code>: An <span class="group-scala"><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span>[<span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterStateSubscription.html" title="org.apache.pekko.cluster.typed.ClusterStateSubscription"><code>cluster.typed.ClusterStateSubscription</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterStateSubscription.html" title="org.apache.pekko.cluster.typed.ClusterStateSubscription"><code>cluster.typed.ClusterStateSubscription</code></a></span>]</span><span class="group-java"><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorRef.html" title="org.apache.pekko.actor.typed.ActorRef"><code>ActorRef</code></a></span>&lt;<span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterStateSubscription.html" title="org.apache.pekko.cluster.typed.ClusterStateSubscription"><code>cluster.typed.ClusterStateSubscription</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/ClusterStateSubscription.html" title="org.apache.pekko.cluster.typed.ClusterStateSubscription"><code>cluster.typed.ClusterStateSubscription</code></a></span>&gt;</span> where a <code>ClusterStateSubscription</code> is one of <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/GetCurrentState.html" title="org.apache.pekko.cluster.typed.GetCurrentState"><code>GetCurrentState</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/GetCurrentState.html" title="org.apache.pekko.cluster.typed.GetCurrentState"><code>GetCurrentState</code></a></span> or <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Subscribe.html" title="org.apache.pekko.cluster.typed.Subscribe"><code>Subscribe</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Subscribe.html" title="org.apache.pekko.cluster.typed.Subscribe"><code>Subscribe</code></a></span> and <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Unsubscribe.html" title="org.apache.pekko.cluster.typed.Unsubscribe"><code>Unsubscribe</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Unsubscribe.html" title="org.apache.pekko.cluster.typed.Unsubscribe"><code>Unsubscribe</code></a></span> to cluster events like <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$MemberRemoved.html" title="org.apache.pekko.cluster.ClusterEvent.MemberRemoved"><code>MemberRemoved</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$MemberRemoved.html" title="org.apache.pekko.cluster.ClusterEvent.MemberRemoved"><code>MemberRemoved</code></a></span></li>
  <li><code>state</code>: The current <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$CurrentClusterState.html" title="org.apache.pekko.cluster.ClusterEvent.CurrentClusterState"><code>CurrentClusterState</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$CurrentClusterState.html" title="org.apache.pekko.cluster.ClusterEvent.CurrentClusterState"><code>CurrentClusterState</code></a></span></li>
</ul>
<p>All of the examples below assume the following imports:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L25-L30" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko
import pekko.actor.typed._
import pekko.actor.typed.scaladsl._
import pekko.cluster.ClusterEvent._
import pekko.cluster.MemberStatus
import pekko.cluster.typed._</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L25-L28" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.typed.*;
import org.apache.pekko.actor.typed.javadsl.*;
import org.apache.pekko.cluster.ClusterEvent;
import org.apache.pekko.cluster.typed.*;</code></pre></dd>
</dl>
<a id="basic-cluster-configuration"></a>
<p>The minimum configuration required is to set a host/port for remoting and the <code>pekko.actor.provider = &quot;cluster&quot;</code>.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L42-L60" target="_blank" title="Go to snippet source">source</a><code class="language-scala">pekko {
  actor {
    provider = &quot;cluster&quot;
  }
  remote.artery {
    canonical {
      hostname = &quot;127.0.0.1&quot;
      port = 2551
    }
  }

  cluster {
    seed-nodes = [
      &quot;akka://ClusterSystem@127.0.0.1:2551&quot;,
      &quot;akka://ClusterSystem@127.0.0.1:2552&quot;]
    
    downing-provider-class = &quot;org.apache.pekko.cluster.sbr.SplitBrainResolverProvider&quot;
  }
}</code></pre>
<p>Accessing the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Cluster$.html" title="org.apache.pekko.cluster.typed.Cluster"><code>Cluster</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/typed/Cluster$.html" title="org.apache.pekko.cluster.typed.Cluster"><code>Cluster</code></a></span> extension on each node:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L194" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val cluster = Cluster(system)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L67" target="_blank" title="Go to snippet source">source</a><code class="language-java">Cluster cluster = Cluster.get(system);</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>The name of the cluster&rsquo;s <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> must be the same for all members, which is passed in when you start the <code>ActorSystem</code>.</p></div>
<h3><a href="#joining-and-leaving-a-cluster" name="joining-and-leaving-a-cluster" class="anchor"><span class="anchor-link"></span></a>Joining and Leaving a Cluster</h3>
<p>If not using configuration to specify <a href="cluster.html#joining">seed nodes to join</a>, joining the cluster can be done programmatically via the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#manager:org.apache.pekko.actor.typed.ActorRef[org.apache.pekko.cluster.typed.ClusterCommand]" title="pekko.cluster.typed.Cluster"><code>manager</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#manager()" title="pekko.cluster.typed.Cluster"><code>manager()</code></a></span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L199" target="_blank" title="Go to snippet source">source</a><code class="language-scala">cluster.manager ! Join(cluster.selfMember.address)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L72" target="_blank" title="Go to snippet source">source</a><code class="language-java">cluster.manager().tell(Join.create(cluster.selfMember().address()));</code></pre></dd>
</dl>
<p><a href="cluster.html#leaving">Leaving</a> the cluster and <a href="cluster.html#downing">downing</a> a node are similar:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L209" target="_blank" title="Go to snippet source">source</a><code class="language-scala">cluster2.manager ! Leave(cluster2.selfMember.address)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L86" target="_blank" title="Go to snippet source">source</a><code class="language-java">cluster2.manager().tell(Leave.create(cluster2.selfMember().address()));</code></pre></dd>
</dl>
<h3><a href="#cluster-subscriptions" name="cluster-subscriptions" class="anchor"><span class="anchor-link"></span></a>Cluster Subscriptions</h3>
<p>Cluster <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#subscriptions:org.apache.pekko.actor.typed.ActorRef[org.apache.pekko.cluster.typed.ClusterStateSubscription]" title="pekko.cluster.typed.Cluster"><code>subscriptions</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#subscriptions()" title="pekko.cluster.typed.Cluster"><code>subscriptions()</code></a></span> can be used to receive messages when cluster state changes. For example, registering for all <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$MemberEvent.html" title="org.apache.pekko.cluster.ClusterEvent.MemberEvent"><code>MemberEvent</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$MemberEvent.html" title="org.apache.pekko.cluster.ClusterEvent.MemberEvent"><code>MemberEvent</code></a></span>&rsquo;s, then using the <code>manager</code> to have a node leave the cluster will result in events for the node going through the <a href="cluster-membership.html#membership-lifecycle">Membership Lifecycle</a>.</p>
<p>This example subscribes to a <span class="group-scala"><code>subscriber: ActorRef[MemberEvent]</code></span><span class="group-java"><code>ActorRef&lt;MemberEvent&gt; subscriber</code></span>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L237" target="_blank" title="Go to snippet source">source</a><code class="language-scala">cluster.subscriptions ! Subscribe(subscriber, classOf[MemberEvent])</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L111" target="_blank" title="Go to snippet source">source</a><code class="language-java">cluster.subscriptions().tell(Subscribe.create(subscriber, ClusterEvent.MemberEvent.class));</code></pre></dd>
</dl>
<p>Then asking a node to leave:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L272-L273" target="_blank" title="Go to snippet source">source</a><code class="language-scala">cluster.manager ! Leave(anotherMemberAddress)
// subscriber will receive events MemberLeft, MemberExited and MemberRemoved</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L116-L117" target="_blank" title="Go to snippet source">source</a><code class="language-java">cluster.manager().tell(Leave.create(anotherMemberAddress));
// subscriber will receive events MemberLeft, MemberExited and MemberRemoved</code></pre></dd>
</dl>
<h3><a href="#cluster-state" name="cluster-state" class="anchor"><span class="anchor-link"></span></a>Cluster State</h3>
<p>Instead of subscribing to cluster events it can sometimes be convenient to only get the full membership state with <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#state:org.apache.pekko.cluster.ClusterEvent.CurrentClusterState" title="pekko.cluster.typed.Cluster"><code>Cluster(system).state</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#state()" title="pekko.cluster.typed.Cluster"><code>Cluster.get(system).state()</code></a></span>. Note that this state is not necessarily in sync with the events published to a cluster subscription.</p>
<p>See <a href="cluster-membership.html#member-events">Cluster Membership</a> more information on member events specifically. There are more types of change events, consult the API documentation of classes that extends <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$ClusterDomainEvent.html" title="org.apache.pekko.cluster.ClusterEvent.ClusterDomainEvent"><code>cluster.ClusterEvent.ClusterDomainEvent</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$ClusterDomainEvent.html" title="org.apache.pekko.cluster.ClusterEvent.ClusterDomainEvent"><code>cluster.ClusterEvent.ClusterDomainEvent</code></a></span> for details about the events.</p>
<h2><a href="#cluster-membership-api" name="cluster-membership-api" class="anchor"><span class="anchor-link"></span></a>Cluster Membership API</h2>
<h3><a href="#joining" name="joining" class="anchor"><span class="anchor-link"></span></a>Joining</h3>
<p>The seed nodes are initial contact points for joining a cluster, which can be done in different ways:</p>
<ul>
  <li><a href="cluster.html#joining-automatically-to-seed-nodes-with-cluster-bootstrap">automatically with Cluster Bootstrap</a></li>
  <li><a href="cluster.html#joining-configured-seed-nodes">with configuration of seed-nodes</a></li>
  <li><a href="cluster.html#joining-programmatically-to-seed-nodes">programatically</a></li>
</ul>
<p>After the joining process the seed nodes are not special and they participate in the cluster in exactly the same way as other nodes.</p>
<h4><a href="#joining-automatically-to-seed-nodes-with-cluster-bootstrap" name="joining-automatically-to-seed-nodes-with-cluster-bootstrap" class="anchor"><span class="anchor-link"></span></a>Joining automatically to seed nodes with Cluster Bootstrap</h4>
<p>Automatic discovery of nodes for the joining process is available using the open source Pekko Management project&rsquo;s module, <a href="../additional/operations.html#cluster-bootstrap">Cluster Bootstrap</a>. Please refer to its documentation for more details.</p>
<h4><a href="#joining-configured-seed-nodes" name="joining-configured-seed-nodes" class="anchor"><span class="anchor-link"></span></a>Joining configured seed nodes</h4>
<p>When a new node is started it sends a message to all seed nodes and then sends a join command to the one that answers first. If none of the seed nodes replies (might not be started yet) it retries this procedure until success or shutdown.</p>
<p>You can define the seed nodes in the <a href="cluster.html#configuration">configuration</a> file (application.conf):</p>
<pre><code>pekko.cluster.seed-nodes = [
  &quot;pekko://ClusterSystem@host1:2552&quot;,
  &quot;pekko://ClusterSystem@host2:2552&quot;]
</code></pre>
<p>This can also be defined as Java system properties when starting the JVM using the following syntax:</p>
<pre><code>-Dpekko.cluster.seed-nodes.0=pekko://ClusterSystem@host1:2552
-Dpekko.cluster.seed-nodes.1=pekko://ClusterSystem@host2:2552
</code></pre>
<p>When a new node is started it sends a message to all configured <code>seed-nodes</code> and then sends a join command to the one that answers first. If none of the seed nodes replies (might not be started yet) it retries this procedure until successful or shutdown.</p>
<p>The seed nodes can be started in any order. It is not necessary to have all seed nodes running, but the node configured as the <strong>first element</strong> in the <code>seed-nodes</code> list must be started when initially starting a cluster. If it is not, the other seed-nodes will not become initialized, and no other node can join the cluster. The reason for the special first seed node is to avoid forming separated islands when starting from an empty cluster. It is quickest to start all configured seed nodes at the same time (order doesn&rsquo;t matter), otherwise it can take up to the configured <code>seed-node-timeout</code> until the nodes can join.</p>
<p>As soon as more than two seed nodes have been started, it is no problem to shut down the first seed node. If the first seed node is restarted, it will first try to join the other seed nodes in the existing cluster. Note that if you stop all seed nodes at the same time and restart them with the same <code>seed-nodes</code> configuration they will join themselves and form a new cluster, instead of joining remaining nodes of the existing cluster. That is likely not desired and can be avoided by listing several nodes as seed nodes for redundancy, and don&rsquo;t stop all of them at the same time.</p>
<p>If you are going to start the nodes on different machines you need to specify the ip-addresses or host names of the machines in <code>application.conf</code> instead of <code>127.0.0.1</code></p>
<h4><a href="#joining-programmatically-to-seed-nodes" name="joining-programmatically-to-seed-nodes" class="anchor"><span class="anchor-link"></span></a>Joining programmatically to seed nodes</h4>
<p>Joining programmatically is useful when <strong>dynamically discovering</strong> other nodes at startup through an external tool or API.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L73-L79" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import pekko.actor.Address
import pekko.actor.AddressFromURIString
import pekko.cluster.typed.JoinSeedNodes

val seedNodes: List[Address] =
  List(&quot;akka://ClusterSystem@127.0.0.1:2551&quot;, &quot;akka://ClusterSystem@127.0.0.1:2552&quot;).map(AddressFromURIString.parse)
Cluster(system).manager ! JoinSeedNodes(seedNodes)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L17-L137" target="_blank" title="Go to snippet source">source</a><code class="language-java">import org.apache.pekko.actor.Address;
import org.apache.pekko.actor.AddressFromURIString;
import org.apache.pekko.cluster.Member;
import org.apache.pekko.cluster.typed.JoinSeedNodes;

List&lt;Address&gt; seedNodes = new ArrayList&lt;&gt;();
seedNodes.add(AddressFromURIString.parse(&quot;akka://ClusterSystem@127.0.0.1:2551&quot;));
seedNodes.add(AddressFromURIString.parse(&quot;akka://ClusterSystem@127.0.0.1:2552&quot;));

Cluster.get(system).manager().tell(new JoinSeedNodes(seedNodes));</code></pre></dd>
</dl>
<p>The seed node address list has the same semantics as the configured <code>seed-nodes</code>, and the the underlying implementation of the process is the same, see <a href="cluster.html#joining-configured-seed-nodes">Joining configured seed nodes</a>.</p>
<p>When joining to seed nodes you should not include the node itself, except for the node that is supposed to be the first seed node bootstrapping the cluster. The desired initial seed node address should be placed first in the parameter to the programmatic join.</p>
<h4><a href="#tuning-joins" name="tuning-joins" class="anchor"><span class="anchor-link"></span></a>Tuning joins</h4>
<p>Unsuccessful attempts to contact seed nodes are automatically retried after the time period defined in configuration property <code>seed-node-timeout</code>. Unsuccessful attempts to join a specific seed node are automatically retried after the configured <code>retry-unsuccessful-join-after</code>. Retrying means that it tries to contact all seed nodes, then joins the node that answers first. The first node in the list of seed nodes will join itself if it cannot contact any of the other seed nodes within the configured <code>seed-node-timeout</code>.</p>
<p>The joining of given seed nodes will, by default, be retried indefinitely until a successful join. That process can be aborted if unsuccessful by configuring a timeout. When aborted it will run <a href="../coordinated-shutdown.html">Coordinated Shutdown</a>, which will terminate the ActorSystem by default. CoordinatedShutdown can also be configured to exit the JVM. If the <code>seed-nodes</code> are assembled dynamically, it is useful to define this timeout, and a restart with new seed-nodes should be tried after unsuccessful attempts.</p>
<pre><code>pekko.cluster.shutdown-after-unsuccessful-join-seed-nodes = 20s
pekko.coordinated-shutdown.exit-jvm = on
</code></pre>
<p>If you don&rsquo;t configure seed nodes or use one of the join seed node functions, you need to join the cluster manually by using <a href="../additional/operations.html#jmx">JMX</a> or <a href="../additional/operations.html#http">HTTP</a>.</p>
<p>You can join to any node in the cluster. It does not have to be configured as a seed node. Note that you can only join to an existing cluster member, which for bootstrapping means a node must join itself and subsequent nodes could join them to make up a cluster.</p>
<p>An actor system can only join a cluster once, additional attempts will be ignored. Once an actor system has successfully joined a cluster, it would have to be restarted to join the same cluster again. It can use the same host name and port after the restart. When it come up as a new incarnation of an existing member in the cluster and attempts to join, the existing member will be removed and its new incarnation allowed to join.</p>
<h3><a href="#leaving" name="leaving" class="anchor"><span class="anchor-link"></span></a>Leaving</h3>
<p>There are a few ways to remove a member from the cluster.</p>
<ol>
  <li>The recommended way to leave a cluster is a graceful exit, informing the cluster that a node shall leave.  This is performed by <a href="../coordinated-shutdown.html">Coordinated Shutdown</a> when the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/actor/typed/ActorSystem.html" title="org.apache.pekko.actor.typed.ActorSystem"><code>ActorSystem</code></a></span>  is terminated and also when a SIGTERM is sent from the environment to stop the JVM process.</li>
  <li>Graceful exit can also be performed using <a href="../additional/operations.html#http">HTTP</a> or <a href="../additional/operations.html#jmx">JMX</a>.</li>
  <li>When a graceful exit is not possible, for example in case of abrupt termination of the the JVM process, the node  will be detected as unreachable by other nodes and removed after <a href="cluster.html#downing">Downing</a>.</li>
</ol>
<p>Graceful leaving offers faster hand off to peer nodes during node shutdown than abrupt termination and downing.</p>
<p>The <a href="../coordinated-shutdown.html">Coordinated Shutdown</a> will also run when the cluster node sees itself as <code>Exiting</code>, i.e. leaving from another node will trigger the shutdown process on the leaving node. Tasks for graceful leaving of cluster, including graceful shutdown of Cluster Singletons and Cluster Sharding, are added automatically when Pekko Cluster is used. For example, running the shutdown process will also trigger the graceful leaving if not already in progress.</p>
<p>Normally this is handled automatically, but in case of network failures during this process it may still be necessary to set the node’s status to <code>Down</code> in order to complete the removal, see <a href="cluster.html#downing">Downing</a>.</p>
<h3><a href="#downing" name="downing" class="anchor"><span class="anchor-link"></span></a>Downing</h3>
<p>In many cases a member can gracefully exit from the cluster, as described in <a href="cluster.html#leaving">Leaving</a>, but there are scenarios when an explicit downing decision is needed before it can be removed. For example in case of abrupt termination of the the JVM process, system overload that doesn&rsquo;t recover, or network partitions that don&rsquo;t heal. In such cases, the node(s) will be detected as unreachable by other nodes, but they must also be marked as <code>Down</code> before they are removed.</p>
<p>When a member is considered by the failure detector to be <code>unreachable</code> the leader is not allowed to perform its duties, such as changing status of new joining members to &lsquo;Up&rsquo;. The node must first become <code>reachable</code> again, or the status of the unreachable member must be changed to <code>Down</code>. Changing status to <code>Down</code> can be performed automatically or manually.</p>
<p>We recommend that you enable the <a href="../split-brain-resolver.html">Split Brain Resolver</a> that is part of the Pekko Cluster module. You enable it with configuration:</p>
<pre><code>pekko.cluster.downing-provider-class = &quot;org.apache.pekko.cluster.sbr.SplitBrainResolverProvider&quot;
</code></pre>
<p>You should also consider the different available <a href="../split-brain-resolver.html#strategies">downing strategies</a>.</p>
<p>If a downing provider is not configured downing must be performed manually using <a href="../additional/operations.html#http">HTTP</a> or <a href="../additional/operations.html#jmx">JMX</a>.</p>
<p>Note that <a href="cluster-singleton.html">Cluster Singleton</a> or <a href="cluster-sharding.html">Cluster Sharding entities</a> that are running on a crashed (unreachable) node will not be started on another node until the previous node has been removed from the Cluster. Removal of crashed (unreachable) nodes is performed after a downing decision.</p>
<p>Downing can also be performed programmatically with <span class="group-scala"><code>Cluster(system).manager ! Down(address)</code></span><span class="group-java"><code>Cluster.get(system).manager().tell(Down(address))</code></span>, but that is mostly useful from tests and when implementing a <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/DowningProvider.html" title="org.apache.pekko.cluster.DowningProvider"><code>DowningProvider</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/DowningProvider.html" title="org.apache.pekko.cluster.DowningProvider"><code>DowningProvider</code></a></span>.</p>
<p>If a crashed node is restarted and joining the cluster again with the same hostname and port, the previous incarnation of that member will first be downed and removed. The new join attempt with same hostname and port is used as evidence that the previous is no longer alive.</p>
<p>If a node is still running and sees its self as <code>Down</code> it will shutdown. <a href="../coordinated-shutdown.html">Coordinated Shutdown</a> will automatically run if <code>run-coordinated-shutdown-when-down</code> is set to <code>on</code> (the default) however the node will not try and leave the cluster gracefully.</p>
<h2><a href="#node-roles" name="node-roles" class="anchor"><span class="anchor-link"></span></a>Node Roles</h2>
<p>Not all nodes of a cluster need to perform the same function. For example, there might be one sub-set which runs the web front-end, one which runs the data access layer and one for the number-crunching. Choosing which actors to start on each node, for example cluster-aware routers, can take node roles into account to achieve this distribution of responsibilities.</p>
<p>The node roles are defined in the configuration property named <code>pekko.cluster.roles</code> and typically defined in the start script as a system property or environment variable.</p>
<p>The roles are part of the membership information in <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$MemberEvent.html" title="org.apache.pekko.cluster.ClusterEvent.MemberEvent"><code>MemberEvent</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/ClusterEvent$$MemberEvent.html" title="org.apache.pekko.cluster.ClusterEvent.MemberEvent"><code>MemberEvent</code></a></span> that you can subscribe to. The roles of the own node are available from the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#selfMember:org.apache.pekko.cluster.Member" title="pekko.cluster.typed.Cluster"><code>selfMember</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/current/org/apache/pekko/cluster/typed/Cluster.html#selfMember()" title="pekko.cluster.typed.Cluster"><code>selfMember()</code></a></span> and that can be used for conditionally starting certain actors:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/scala/docs/org/apache/pekko/cluster/typed/BasicClusterExampleSpec.scala#L95-L100" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val selfMember = Cluster(context.system).selfMember
if (selfMember.hasRole(&quot;backend&quot;)) {
  context.spawn(Backend(), &quot;back&quot;)
} else if (selfMember.hasRole(&quot;frontend&quot;)) {
  context.spawn(Frontend(), &quot;front&quot;)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/cluster-typed/src/test/java/jdocs/org/apache/pekko/cluster/typed/BasicClusterExampleTest.java#L157-L162" target="_blank" title="Go to snippet source">source</a><code class="language-java">Member selfMember = Cluster.get(context.getSystem()).selfMember();
if (selfMember.hasRole(&quot;backend&quot;)) {
  context.spawn(Backend.create(), &quot;back&quot;);
} else if (selfMember.hasRole(&quot;front&quot;)) {
  context.spawn(Frontend.create(), &quot;front&quot;);
}</code></pre></dd>
</dl>
<h2><a href="#failure-detector" name="failure-detector" class="anchor"><span class="anchor-link"></span></a>Failure Detector</h2>
<p>The nodes in the cluster monitor each other by sending heartbeats to detect if a node is unreachable from the rest of the cluster. Please see:</p>
<ul>
  <li><a href="cluster-concepts.html#failure-detector">Failure Detector specification</a></li>
  <li><a href="failure-detector.html">Phi Accrual Failure Detector</a> implementation</li>
  <li><a href="cluster.html#using-the-failure-detector">Using the Failure Detector</a></li>
</ul>
<h3><a href="#using-the-failure-detector" name="using-the-failure-detector" class="anchor"><span class="anchor-link"></span></a>Using the Failure Detector</h3>
<p>Cluster uses the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/remote/PhiAccrualFailureDetector.html" title="org.apache.pekko.remote.PhiAccrualFailureDetector"><code>remote.PhiAccrualFailureDetector</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/remote/PhiAccrualFailureDetector.html" title="org.apache.pekko.remote.PhiAccrualFailureDetector"><code>remote.PhiAccrualFailureDetector</code></a></span> failure detector by default, or you can provide your by implementing the <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/remote/FailureDetector.html" title="org.apache.pekko.remote.FailureDetector"><code>remote.FailureDetector</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/remote/FailureDetector.html" title="org.apache.pekko.remote.FailureDetector"><code>remote.FailureDetector</code></a></span> and configuring it:</p>
<pre><code>pekko.cluster.implementation-class = &quot;com.example.CustomFailureDetector&quot;
</code></pre>
<p>In the <a href="cluster.html#configuration">Cluster Configuration</a> you may want to adjust these depending on you environment:</p>
<ul>
  <li>When a <em>phi</em> value is considered to be a failure <code>pekko.cluster.failure-detector.threshold</code></li>
  <li>Margin of error for sudden abnormalities <code>pekko.cluster.failure-detector.acceptable-heartbeat-pause</code></li>
</ul>
<h2><a href="#how-to-test" name="how-to-test" class="anchor"><span class="anchor-link"></span></a>How to test</h2>
<p>Pekko comes with and uses several types of testing strategies:</p>
<ul>
  <li><a href="testing.html">Testing</a></li>
  <li><a href="../multi-node-testing.html">Multi Node Testing</a></li>
  <li><a href="../multi-jvm-testing.html">Multi JVM Testing</a></li>
</ul>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<p>There are several configuration properties for the cluster. Refer to the <a href="../general/configuration-reference.html#config-pekko-cluster">reference configuration</a> for full configuration descriptions, default values and options.</p>
<h3><a href="#how-to-startup-when-a-cluster-size-is-reached" name="how-to-startup-when-a-cluster-size-is-reached" class="anchor"><span class="anchor-link"></span></a>How To Startup when a Cluster size is reached</h3>
<p>A common use case is to start actors after the cluster has been initialized, members have joined, and the cluster has reached a certain size.</p>
<p>With a configuration option you can define the required number of members before the leader changes member status of &lsquo;Joining&rsquo; members to &lsquo;Up&rsquo;.:</p>
<pre><code>pekko.cluster.min-nr-of-members = 3
</code></pre>
<p>In a similar way you can define the required number of members of a certain role before the leader changes member status of &lsquo;Joining&rsquo; members to &lsquo;Up&rsquo;.:</p>
<pre><code>pekko.cluster.role {
  frontend.min-nr-of-members = 1
  backend.min-nr-of-members = 2
}
</code></pre>
<h3><a href="#cluster-info-logging" name="cluster-info-logging" class="anchor"><span class="anchor-link"></span></a>Cluster Info Logging</h3>
<p>You can silence the logging of cluster events at info level with configuration property:</p>
<pre><code>pekko.cluster.log-info = off
</code></pre>
<p>You can enable verbose logging of cluster events at info level, e.g. for temporary troubleshooting, with configuration property:</p>
<pre><code>pekko.cluster.log-info-verbose = on
</code></pre>
<h3><a href="#cluster-dispatcher" name="cluster-dispatcher" class="anchor"><span class="anchor-link"></span></a>Cluster Dispatcher</h3>
<p>The Cluster extension is implemented with actors. To protect them against disturbance from user actors they are by default run on the internal dispatcher configured under <code>pekko.actor.internal-dispatcher</code>. The cluster actors can potentially be isolated even further, onto their own dispatcher using the setting <code>pekko.cluster.use-dispatcher</code> or made run on the same dispatcher to keep the number of threads down.</p>
<h3><a href="#configuration-compatibility-check" name="configuration-compatibility-check" class="anchor"><span class="anchor-link"></span></a>Configuration Compatibility Check</h3>
<p>Creating a cluster is about deploying two or more nodes and having them behave as if they were a single application. Therefore it&rsquo;s extremely important that all nodes in a cluster are configured with compatible settings. </p>
<p>The Configuration Compatibility Check feature ensures that all nodes in a cluster have a compatible configuration. Whenever a new node is joining an existing cluster, a subset of its configuration settings (only those that are required to be checked) is sent to the nodes in the cluster for verification. Once the configuration is checked on the cluster side, the cluster sends back its own set of required configuration settings. The joining node will then verify if it&rsquo;s compliant with the cluster configuration. The joining node will only proceed if all checks pass, on both sides. </p>
<p>New custom checkers can be added by extending <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/JoinConfigCompatChecker.html" title="org.apache.pekko.cluster.JoinConfigCompatChecker"><code>cluster.JoinConfigCompatChecker</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/cluster/JoinConfigCompatChecker.html" title="org.apache.pekko.cluster.JoinConfigCompatChecker"><code>cluster.JoinConfigCompatChecker</code></a></span> and including them in the configuration. Each checker must be associated with a unique key:</p>
<pre><code>pekko.cluster.configuration-compatibility-check.checkers {
  my-custom-config = &quot;com.company.MyCustomJoinConfigCompatChecker&quot;
}
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>Configuration Compatibility Check is enabled by default, but can be disabled by setting <code>pekko.cluster.configuration-compatibility-check.enforce-on-join = off</code>. This is specially useful when performing rolling updates. Obviously this should only be done if a complete cluster shutdown isn&rsquo;t an option. A cluster with nodes with different configuration settings may lead to data loss or data corruption. </p>
<p>This setting should only be disabled on the joining nodes. The checks are always performed on both sides, and warnings are logged. In case of incompatibilities, it is the responsibility of the joining node to decide if the process should be interrupted or not. </p></div>
<h2><a href="#higher-level-cluster-tools" name="higher-level-cluster-tools" class="anchor"><span class="anchor-link"></span></a>Higher level Cluster tools</h2><h3><a href="#cluster-singleton" name="cluster-singleton" class="anchor"><span class="anchor-link"></span></a>Cluster Singleton</h3>
<p>For some use cases it is convenient or necessary to ensure only one actor of a certain type is running somewhere in the cluster. This can be implemented by subscribing to member events, but there are several corner cases to consider. Therefore, this specific use case is covered by the Cluster Singleton.</p>
<p>See <a href="cluster-singleton.html">Cluster Singleton</a>.</p><h3><a href="#cluster-sharding" name="cluster-sharding" class="anchor"><span class="anchor-link"></span></a>Cluster Sharding</h3>
<p>Distributes actors across several nodes in the cluster and supports interaction with the actors using their logical identifier, but without having to care about their physical location in the cluster.</p>
<p>See <a href="cluster-sharding.html">Cluster Sharding</a>.</p><h3><a href="#distributed-data" name="distributed-data" class="anchor"><span class="anchor-link"></span></a>Distributed Data</h3>
<p>Distributed Data is useful when you need to share data between nodes in an Pekko Cluster. The data is accessed with an actor providing a key-value store like API.</p>
<p>See <a href="distributed-data.html">Distributed Data</a>.</p><h3><a href="#distributed-publish-subscribe" name="distributed-publish-subscribe" class="anchor"><span class="anchor-link"></span></a>Distributed Publish Subscribe</h3>
<p>Publish-subscribe messaging between actors in the cluster based on a topic, i.e. the sender does not have to know on which node the destination actor is running.</p>
<p>See <a href="distributed-pub-sub.html">Distributed Publish Subscribe</a>.</p><h3><a href="#cluster-aware-routers" name="cluster-aware-routers" class="anchor"><span class="anchor-link"></span></a>Cluster aware routers</h3>
<p>Distribute messages to actors on different nodes in the cluster with routing strategies like round-robin and consistent hashing.</p>
<p>See <a href="routers.html#group-router">Group Routers</a>. </p><h3><a href="#cluster-across-multiple-data-centers" name="cluster-across-multiple-data-centers" class="anchor"><span class="anchor-link"></span></a>Cluster across multiple data centers</h3>
<p>Pekko Cluster can be used across multiple data centers, availability zones or regions, so that one Cluster can span multiple data centers and still be tolerant to network partitions.</p>
<p>See <a href="cluster-dc.html">Cluster Multi-DC</a>.</p><h3><a href="#reliable-delivery" name="reliable-delivery" class="anchor"><span class="anchor-link"></span></a>Reliable Delivery</h3>
<p>Reliable delivery and flow control of messages between actors in the Cluster.</p>
<p>See <a href="reliable-delivery.html">Reliable Delivery</a></p>
<h2><a href="#example-project" name="example-project" class="anchor"><span class="anchor-link"></span></a>Example project</h2>
<p><span class="group-java"><a href="https://developer.lightbend.com/start/?group=akka&amp;project=pekko-samples-cluster-java">Cluster example project</a></span> <span class="group-scala"><a href="https://developer.lightbend.com/start/?group=akka&amp;project=pekko-samples-cluster-scala">Cluster example project</a></span> is an example project that can be downloaded, and with instructions of how to run.</p>
<p>This project contains samples illustrating different Cluster features, such as subscribing to cluster membership events, and sending messages to actors running on nodes in the cluster with Cluster aware routers.</p>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/typed/cluster.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../typed/index-cluster.html" title="Cluster" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Cluster
</span>
</div>
</a>
<a href="../typed/cluster-concepts.html" title="Cluster Specification" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Cluster Specification
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright © 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../assets/js/groups.js"></script>
</body>
</html>
