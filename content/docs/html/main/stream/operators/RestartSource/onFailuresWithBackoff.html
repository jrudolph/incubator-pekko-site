<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<link rel="shortcut icon" href="../../../assets/images/favicon.png">
<title>RestartSource.onFailuresWithBackoff Â· Apache Pekko</title>
<link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../lib/prettify/prettify.css">
<script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../../../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
RestartSource.onFailuresWithBackoff
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../../../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../../../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../../../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../../../downloads.html" class="page">Downloads</a></li>
  <li><a href="../../../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../../../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../../../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../../../typed/index.html" class="page">Actors</a></li>
    <li><a href="../../../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../../../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../../../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../../../stream/index.html" class="page">Streams</a></li>
    <li><a href="../../../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../../../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../../../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../../../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../../../project/index.html" class="page">Project Information</a></li>
    <li><a href="../../../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#restartsource-onfailureswithbackoff" class="header">RestartSource.onFailuresWithBackoff</a>
  <ul>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#signature" class="header">Signature</a></li>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#description" class="header">Description</a></li>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#examples" class="header">Examples</a></li>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#reactive-streams-semantics" class="header">Reactive Streams semantics</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#restartsource-onfailureswithbackoff" class="header">RestartSource.onFailuresWithBackoff</a>
  <ul>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#signature" class="header">Signature</a></li>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#description" class="header">Description</a></li>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#examples" class="header">Examples</a></li>
    <li><a href="../../../stream/operators/RestartSource/onFailuresWithBackoff.html#reactive-streams-semantics" class="header">Reactive Streams semantics</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#restartsource-onfailureswithbackoff" name="restartsource-onfailureswithbackoff" class="anchor"><span class="anchor-link"></span></a>RestartSource.onFailuresWithBackoff</h1>
<p>Wrap the given <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> with a <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> that will restart it when it fails using an exponential backoff. Notice that this <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> will not restart on completion of the wrapped flow.</p>
<p><a href="../index.html#error-handling">Error handling</a></p>
<h2><a href="#signature" name="signature" class="anchor"><span class="anchor-link"></span></a>Signature</h2>
<p><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/RestartSource$.html#onFailuresWithBackoff(org.apache.pekko.stream.RestartSettings,org.apache.pekko.japi.function.Creator)" title="org.apache.pekko.stream.javadsl.RestartSource"><code>RestartSource.onFailuresWithBackoff</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/RestartSource$.html#onFailuresWithBackoff[T](settings:org.apache.pekko.stream.RestartSettings)(sourceFactory:()=&gt;org.apache.pekko.stream.scaladsl.Source[T,_]):org.apache.pekko.stream.scaladsl.Source[T,org.apache.pekko.NotUsed]" title="org.apache.pekko.stream.scaladsl.RestartSource"><code>RestartSource.onFailuresWithBackoff</code></a></span></p>
<h2><a href="#description" name="description" class="anchor"><span class="anchor-link"></span></a>Description</h2>
<p>Wraps the given <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> with a <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> that will restart it when it fails using exponential backoff. The backoff resets back to <code>minBackoff</code> if there hasn&rsquo;t been a restart within <code>maxRestartsWithin</code> (which defaults to <code>minBackoff</code>).</p>
<p>This <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> will not emit a failure as long as maxRestarts is not reached. The failure of the wrapped <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> is handled by restarting it. However, the wrapped <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> can be cancelled by cancelling this <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span>. When that happens, the wrapped <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span>, if currently running will, be cancelled and not restarted. This can be triggered by the downstream cancelling, or externally by introducing a <a href="../../stream-dynamic.html#controlling-stream-completion-with-killswitch">KillSwitch</a> right after this <span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source.html" title="org.apache.pekko.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source.html" title="org.apache.pekko.stream.scaladsl.Source"><code>Source</code></a></span> in the graph.</p>
<p>This uses the same exponential backoff algorithm as <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/pattern/BackoffOpts$.html" title="org.apache.pekko.pattern.BackoffOpts"><code>BackoffOpts</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/pattern/BackoffOpts$.html" title="org.apache.pekko.pattern.BackoffOpts"><code>BackoffOpts</code></a></span>.</p>
<p>See also: </p>
<ul>
  <li><a href="withBackoff.html">RestartSource.withBackoff</a></li>
  <li><a href="../RestartFlow/onFailuresWithBackoff.html">RestartFlow.onFailuresWithBackoff</a></li>
  <li><a href="../RestartFlow/withBackoff.html">RestartFlow.withBackoff</a></li>
  <li><a href="../RestartSink/withBackoff.html">RestartSink.withBackoff</a></li>
</ul>
<h2><a href="#examples" name="examples" class="anchor"><span class="anchor-link"></span></a>Examples</h2>
<p>This shows that a Source is not restarted if it completes, only if it fails. Tick is only printed three times as the <code>take(3)</code> means the inner source completes successfully after emitting the first 3 elements.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/stream/operators/source/Restart.scala#L67-L73" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val finiteSource = Source.tick(1.second, 1.second, &quot;tick&quot;).take(3)
val forever = RestartSource.onFailuresWithBackoff(RestartSettings(1.second, 10.seconds, 0.1))(() =&gt; finiteSource)
forever.runWith(Sink.foreach(println))
// prints
// tick
// tick
// tick</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/stream/operators/source/Restart.java#L87-L97" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;String, Cancellable&gt; finiteSource =
    Source.tick(Duration.ofSeconds(1), Duration.ofSeconds(1), &quot;tick&quot;).take(3);
Source&lt;String, NotUsed&gt; forever =
    RestartSource.onFailuresWithBackoff(
        RestartSettings.create(Duration.ofSeconds(1), Duration.ofSeconds(10), 0.1),
        () -&gt; finiteSource);
forever.runWith(Sink.foreach(System.out::println), system);
// prints
// tick
// tick
// tick</code></pre></dd>
</dl>
<p>If the inner source instead fails, it will be restarted with an increasing backoff. The source emits 1, 2, 3, and then throws an exception. The first time the exception is thrown the source is restarted after 1s, then 2s etc, until the <code>maxBackoff</code> of 10s.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/stream/operators/source/Restart.scala#L38-L59" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// could throw if for example it used a database connection to get rows
val flakySource: Source[() =&gt; Int, NotUsed] =
  Source(List(() =&gt; 1, () =&gt; 2, () =&gt; 3, () =&gt; throw CantConnectToDatabase(&quot;darn&quot;)))
val forever =
  RestartSource.onFailuresWithBackoff(
    RestartSettings(minBackoff = 1.second, maxBackoff = 10.seconds, randomFactor = 0.1))(() =&gt; flakySource)
forever.runWith(Sink.foreach(nr =&gt; system.log.info(&quot;{}&quot;, nr())))
// logs
// [INFO] [12/10/2019 13:51:58.300] [default-pekko.test.stream-dispatcher-7] [pekko.actor.ActorSystemImpl(default)] 1
// [INFO] [12/10/2019 13:51:58.301] [default-pekko.test.stream-dispatcher-7] [pekko.actor.ActorSystemImpl(default)] 2
// [INFO] [12/10/2019 13:51:58.302] [default-pekko.test.stream-dispatcher-7] [pekko.actor.ActorSystemImpl(default)] 3
// [WARN] [12/10/2019 13:51:58.310] [default-pekko.test.stream-dispatcher-7] [RestartWithBackoffSource(pekko://default)] Restarting graph due to failure. stack_trace:  (docs.stream.operators.source.Restart$CantConnectToDatabase: darn)
// --&gt; 1 second gap
// [INFO] [12/10/2019 13:51:59.379] [default-pekko.test.stream-dispatcher-8] [pekko.actor.ActorSystemImpl(default)] 1
// [INFO] [12/10/2019 13:51:59.382] [default-pekko.test.stream-dispatcher-8] [pekko.actor.ActorSystemImpl(default)] 2
// [INFO] [12/10/2019 13:51:59.383] [default-pekko.test.stream-dispatcher-8] [pekko.actor.ActorSystemImpl(default)] 3
// [WARN] [12/10/2019 13:51:59.386] [default-pekko.test.stream-dispatcher-8] [RestartWithBackoffSource(pekko://default)] Restarting graph due to failure. stack_trace:  (docs.stream.operators.source.Restart$CantConnectToDatabase: darn)
// --&gt; 2 second gap
// [INFO] [12/10/2019 13:52:01.594] [default-pekko.test.stream-dispatcher-8] [pekko.actor.ActorSystemImpl(default)] 1
// [INFO] [12/10/2019 13:52:01.595] [default-pekko.test.stream-dispatcher-8] [pekko.actor.ActorSystemImpl(default)] 2
// [INFO] [12/10/2019 13:52:01.595] [default-pekko.test.stream-dispatcher-8] [pekko.actor.ActorSystemImpl(default)] 3
// [WARN] [12/10/2019 13:52:01.596] [default-pekko.test.stream-dispatcher-8] [RestartWithBackoffSource(pekko://default)] Restarting graph due to failure. stack_trace:  (docs.stream.operators.source.Restart$CantConnectToDatabase: darn)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/stream/operators/source/Restart.java#L35-L80" target="_blank" title="Go to snippet source">source</a><code class="language-java">// could throw if for example it used a database connection to get rows
Source&lt;Creator&lt;Integer&gt;, NotUsed&gt; flakySource =
    Source.from(
        Arrays.&lt;Creator&lt;Integer&gt;&gt;asList(
            () -&gt; 1,
            () -&gt; 2,
            () -&gt; 3,
            () -&gt; {
              throw new RuntimeException(&quot;darn&quot;);
            }));
Source&lt;Creator&lt;Integer&gt;, NotUsed&gt; forever =
    RestartSource.onFailuresWithBackoff(
        RestartSettings.create(Duration.ofSeconds(1), Duration.ofSeconds(10), 0.1),
        () -&gt; flakySource);
forever.runWith(
    Sink.foreach((Creator&lt;Integer&gt; nr) -&gt; system.log().info(&quot;{}&quot;, nr.create())), system);
// logs
// [INFO] [12/10/2019 13:51:58.300] [default-pekko.test.stream-dispatcher-7]
// [pekko.actor.ActorSystemImpl(default)] 1
// [INFO] [12/10/2019 13:51:58.301] [default-pekko.test.stream-dispatcher-7]
// [pekko.actor.ActorSystemImpl(default)] 2
// [INFO] [12/10/2019 13:51:58.302] [default-pekko.test.stream-dispatcher-7]
// [pekko.actor.ActorSystemImpl(default)] 3
// [WARN] [12/10/2019 13:51:58.310] [default-pekko.test.stream-dispatcher-7]
// [RestartWithBackoffSource(pekko://default)] Restarting graph due to failure. stack_trace:
// (RuntimeException: darn)
// --&gt; 1 second gap
// [INFO] [12/10/2019 13:51:59.379] [default-pekko.test.stream-dispatcher-8]
// [pekko.actor.ActorSystemImpl(default)] 1
// [INFO] [12/10/2019 13:51:59.382] [default-pekko.test.stream-dispatcher-8]
// [pekko.actor.ActorSystemImpl(default)] 2
// [INFO] [12/10/2019 13:51:59.383] [default-pekko.test.stream-dispatcher-8]
// [pekko.actor.ActorSystemImpl(default)] 3
// [WARN] [12/10/2019 13:51:59.386] [default-pekko.test.stream-dispatcher-8]
// [RestartWithBackoffSource(pekko://default)] Restarting graph due to failure. stack_trace:
// (RuntimeException: darn)
// --&gt; 2 second gap
// [INFO] [12/10/2019 13:52:01.594] [default-pekko.test.stream-dispatcher-8]
// [pekko.actor.ActorSystemImpl(default)] 1
// [INFO] [12/10/2019 13:52:01.595] [default-pekko.test.stream-dispatcher-8]
// [pekko.actor.ActorSystemImpl(default)] 2
// [INFO] [12/10/2019 13:52:01.595] [default-pekko.test.stream-dispatcher-8]
// [pekko.actor.ActorSystemImpl(default)] 3
// [WARN] [12/10/2019 13:52:01.596] [default-pekko.test.stream-dispatcher-8]
// [RestartWithBackoffSource(pekko://default)] Restarting graph due to failure. stack_trace:
// (RuntimeException: darn)</code></pre></dd>
</dl>
<p>Finally, to be able to stop the restarting, a kill switch can be used. The kill switch is inserted right after the restart source. The inner source is the same as above so emits 3 elements and then fails. A killswitch is used to be able to stop the source being restarted: </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/stream/operators/source/Restart.scala#L79-L89" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val flakySource: Source[() =&gt; Int, NotUsed] =
  Source(List(() =&gt; 1, () =&gt; 2, () =&gt; 3, () =&gt; throw CantConnectToDatabase(&quot;darn&quot;)))
val stopRestarting: UniqueKillSwitch =
  RestartSource
    .onFailuresWithBackoff(RestartSettings(1.second, 10.seconds, 0.1))(() =&gt; flakySource)
    .viaMat(KillSwitches.single)(Keep.right)
    .toMat(Sink.foreach(nr =&gt; println(s&quot;Nr ${nr()}&quot;)))(Keep.left)
    .run()
// ... from some where else
// stop the source from restarting
stopRestarting.shutdown()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/stream/operators/source/Restart.java#L103-L121" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;Creator&lt;Integer&gt;, NotUsed&gt; flakySource =
    Source.from(
        Arrays.&lt;Creator&lt;Integer&gt;&gt;asList(
            () -&gt; 1,
            () -&gt; 2,
            () -&gt; 3,
            () -&gt; {
              throw new RuntimeException(&quot;darn&quot;);
            }));
UniqueKillSwitch stopRestarting =
    RestartSource.onFailuresWithBackoff(
            RestartSettings.create(Duration.ofSeconds(1), Duration.ofSeconds(10), 0.1),
            () -&gt; flakySource)
        .viaMat(KillSwitches.single(), Keep.right())
        .toMat(Sink.foreach(nr -&gt; System.out.println(&quot;nr &quot; + nr.create())), Keep.left())
        .run(system);
// ... from some where else
// stop the source from restarting
stopRestarting.shutdown();</code></pre></dd>
</dl>
<h2><a href="#reactive-streams-semantics" name="reactive-streams-semantics" class="anchor"><span class="anchor-link"></span></a>Reactive Streams semantics</h2><div class="callout">
<p><strong>emits</strong> when the wrapped source emits</p>
<p><strong>backpressures</strong> during backoff and when downstream backpressures</p>
<p><strong>completes</strong> when the wrapped source completes or <code>maxRestarts</code> are reached within the given time limit</p>
<p><strong>cancels</strong> when downstream cancels</p></div>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/stream/operators/RestartSource/onFailuresWithBackoff.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../stream/operators/Sink/onComplete.html" title="Sink.onComplete" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sink.onComplete
</span>
</div>
</a>
<a href="../../../stream/operators/RestartFlow/onFailuresWithBackoff.html" title="RestartFlow.onFailuresWithBackoff" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
RestartFlow.onFailuresWithBackoff
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright Â© 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../."}})</script>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../../../assets/js/groups.js"></script>
</body>
</html>
