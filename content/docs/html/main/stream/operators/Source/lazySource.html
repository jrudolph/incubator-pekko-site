<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala.">
<link rel="shortcut icon" href="../../../assets/images/favicon.png">
<title>Source.lazySource · Apache Pekko</title>
<link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../lib/prettify/prettify.css">
<script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../index.html" title="Apache Pekko" class="md-header-nav__button md-logo">
<img src="../../../images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko
</span>
<span class="md-header-nav__topic">
Source.lazySource
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../index.html" title="Apache Pekko" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../../../images/pekko_logo.png" width="24" height="24">
</a>
<a href="../../../index.html" title="Apache Pekko">
Apache Pekko
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../../../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../../../downloads.html" class="page">Downloads</a></li>
  <li><a href="../../../documentation.html" class="page">Documentation</a>
  <ul>
    <li><a href="../../../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../../../general/index.html" class="page">General Concepts</a></li>
    <li><a href="../../../typed/index.html" class="page">Actors</a></li>
    <li><a href="../../../typed/index-cluster.html" class="page">Cluster</a></li>
    <li><a href="../../../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
    <li><a href="../../../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
    <li><a href="../../../stream/index.html" class="page">Streams</a></li>
    <li><a href="../../../discovery/index.html" class="page">Discovery</a></li>
    <li><a href="../../../index-utilities.html" class="page">Utilities</a></li>
    <li><a href="../../../common/other-modules.html" class="page">Other Apache Pekko modules</a></li>
    <li><a href="../../../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
    <li><a href="../../../project/index.html" class="page">Project Information</a></li>
    <li><a href="../../../index-classic.html" class="page">Pekko Classic</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../stream/operators/Source/lazySource.html#source-lazysource" class="header">Source.lazySource</a>
  <ul>
    <li><a href="../../../stream/operators/Source/lazySource.html#signature" class="header">Signature</a></li>
    <li><a href="../../../stream/operators/Source/lazySource.html#description" class="header">Description</a></li>
    <li><a href="../../../stream/operators/Source/lazySource.html#example" class="header">Example</a></li>
    <li><a href="../../../stream/operators/Source/lazySource.html#reactive-streams-semantics" class="header">Reactive Streams semantics</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.6.20+81-523134c3+20230202-1514*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../stream/operators/Source/lazySource.html#source-lazysource" class="header">Source.lazySource</a>
  <ul>
    <li><a href="../../../stream/operators/Source/lazySource.html#signature" class="header">Signature</a></li>
    <li><a href="../../../stream/operators/Source/lazySource.html#description" class="header">Description</a></li>
    <li><a href="../../../stream/operators/Source/lazySource.html#example" class="header">Example</a></li>
    <li><a href="../../../stream/operators/Source/lazySource.html#reactive-streams-semantics" class="header">Reactive Streams semantics</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#source-lazysource" name="source-lazysource" class="anchor"><span class="anchor-link"></span></a>Source.lazySource</h1>
<p>Defers creation and materialization of a <code>Source</code> until there is demand.</p>
<p><a href="../index.html#source-operators">Source operators</a></p>
<h2><a href="#signature" name="signature" class="anchor"><span class="anchor-link"></span></a>Signature</h2>
<p><span class="group-java"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/javadsl/Source$.html#lazySource(org.apache.pekko.japi.function.Creator)" title="org.apache.pekko.stream.javadsl.Source"><code>Source.lazySource</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/2.6.20+81-523134c3+20230202-1514-SNAPSHOT/org/apache/pekko/stream/scaladsl/Source$.html#lazySource[T,M](create:()=&gt;org.apache.pekko.stream.scaladsl.Source[T,M]):org.apache.pekko.stream.scaladsl.Source[T,scala.concurrent.Future[M]]" title="org.apache.pekko.stream.scaladsl.Source"><code>Source.lazySource</code></a></span></p>
<h2><a href="#description" name="description" class="anchor"><span class="anchor-link"></span></a>Description</h2>
<p>Defers creation and materialization of a <code>Source</code> until there is demand, then emits the elements from the source downstream just like if it had been created up front. If the stream fails or cancels before there is demand the factory will not be invoked.</p>
<p>Note that asynchronous boundaries and many other operators in the stream may do pre-fetching or trigger demand earlier than you would expect.</p>
<p>The materialized value of the <code>lazy</code> is a <span class="group-scala"><code>Future</code></span><span class="group-java"><code>CompletionStage</code></span> that is completed with the materialized value of the nested source once that is constructed.</p>
<p>See also:</p>
<ul>
  <li><a href="lazyFutureSource.html">Source.lazyFutureSource</a> and <a href="lazyCompletionStageSource.html">Source.lazyCompletionStageSource</a></li>
  <li><a href="../Flow/lazyFlow.html">Flow.lazyFlow</a></li>
  <li><a href="../Sink/lazySink.html">Sink.lazySink</a></li>
</ul>
<h2><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h2>
<p>In this example you might expect this sample to not construct the expensive source until <code>.pull</code> is called. However, since <code>Sink.queue</code> has a buffer and will ask for that immediately on materialization the expensive source is in created quickly after the stream has been materialized:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/stream/operators/source/Lazy.scala#L29-L39" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val source = Source.lazySource { () =&gt;
  println(&quot;Creating the actual source&quot;)
  createExpensiveSource()
}

val queue = source.runWith(Sink.queue())

// ... time passes ...
// at some point in time we pull the first time
// but the source creation may already have been triggered
queue.pull()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/stream/operators/source/Lazy.java#L37-L49" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;String, CompletionStage&lt;NotUsed&gt;&gt; source =
    Source.lazySource(
        () -&gt; {
          System.out.println(&quot;Creating the actual source&quot;);
          return createExpensiveSource();
        });

SinkQueueWithCancel&lt;String&gt; queue = source.runWith(Sink.queue(), system);

// ... time passes ...
// at some point in time we pull the first time
// but the source creation may already have been triggered
queue.pull();</code></pre></dd>
</dl>
<p>Instead the most useful aspect of the operator is that the factory is called once per stream materialization which means that it can be used to safely construct a mutable object to use with the actual deferred source. </p>
<p>In this example we make use of that by unfolding a mutable object that works like an iterator with a method to say if there are more elements and one that produces the next and moves to the next element.</p>
<p>If the <code>IteratorLikeThing</code> was used directly in a <code>Source.unfold</code> the same instance would end up being unsafely shared across all three materializations of the stream, but wrapping it with <code>Source.lazy</code> ensures we create a separate instance for each of the started streams:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/scala/docs/stream/operators/source/Lazy.scala#L49-L62" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val stream = Source
  .lazySource { () =&gt;
    val iteratorLike = new IteratorLikeThing
    Source.unfold(iteratorLike) { iteratorLike =&gt;
      if (iteratorLike.thereAreMore) Some((iteratorLike, iteratorLike.extractNext))
      else None
    }
  }
  .to(Sink.foreach(println))

// each of the three materializations will have their own instance of IteratorLikeThing
stream.run()
stream.run()
stream.run()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko/tree/main/docs/src/test/java/jdocs/stream/operators/source/Lazy.java#L65-L82" target="_blank" title="Go to snippet source">source</a><code class="language-java">RunnableGraph&lt;CompletionStage&lt;NotUsed&gt;&gt; stream =
    Source.lazySource(
            () -&gt; {
              IteratorLikeThing instance = new IteratorLikeThing();
              return Source.unfold(
                  instance,
                  sameInstance -&gt; {
                    if (sameInstance.thereAreMore())
                      return Optional.of(Pair.create(sameInstance, sameInstance.extractNext()));
                    else return Optional.empty();
                  });
            })
        .to(Sink.foreach(System.out::println));

// each of the three materializations will have their own instance of IteratorLikeThing
stream.run(system);
stream.run(system);
stream.run(system);</code></pre></dd>
</dl>
<p>Note though that you can often also achieve the same using <a href="unfoldResource.html">unfoldResource</a>. If you have an actual <code>Iterator</code> you should prefer <a href="fromIterator.html">fromIterator</a>.</p>
<h2><a href="#reactive-streams-semantics" name="reactive-streams-semantics" class="anchor"><span class="anchor-link"></span></a>Reactive Streams semantics</h2><div class="callout">
<p><strong>emits</strong> depends on the wrapped <code>Source</code></p>
<p><strong>completes</strong> depends on the wrapped <code>Source</code></p></div>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko/tree/main/docs/src/main/paradox/stream/operators/Source/lazySource.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.6.20+81-523134c3+20230202-1514*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../stream/operators/Sink/lazySink.html" title="Sink.lazySink" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sink.lazySink
</span>
</div>
</a>
<a href="../../../stream/operators/Source-or-Flow/limit.html" title="limit" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
limit
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright © 2023 The Apache Software Foundation, Licensed under the Apache License, Version 2.0
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../."}})</script>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../../../assets/js/groups.js"></script>
</body>
</html>
